<?xml version="1.0"?>
<monkeyml version="1.0">
    <io_devices _id="id41139455" tag="IO Devices">
        <iodevice _id="id41139470" tag="LabJackU6" priority="" type="LabJackU6" data_interval="10ms" pulse_duration="rewardDuration_us" pulse_on="juice" lever_press="TTLchannel0" alt=""></iodevice>
    </io_devices>
    <variables _id="id41139491" tag="Variables">
        <folder _id="id41139496" tag="Behavioral Control">
            <variable _id="id41139502" tag="tooFastTimeMs" scope="global" logging="when_changed" default_value="100" type="integer" persistant="1"></variable>
            <variable _id="id41139518" tag="doWaitForUp" scope="global" logging="when_changed" default_value="1" type="integer" persistant="1"></variable>
            <variable _id="id41139534" tag="doAuditoryReleaseStim" scope="global" logging="when_changed" default_value="1" type="integer" persistant="1"></variable>
            <variable _id="id41139550" tag="rewardDuration_us" scope="global" logging="when_changed" default_value="20000" type="integer" persistant="1"></variable>
            <variable _id="id41139567" tag="reactTimeMs" scope="global" logging="when_changed" default_value="3000" type="integer" persistant="1"></variable>
            <variable _id="id41139583" tag="randReqHoldMinMs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1"></variable>
            <variable _id="id41139599" tag="randReqHoldMaxMs" scope="global" logging="when_changed" default_value="300" type="integer" persistant="1"></variable>
            <variable _id="id41139615" tag="fixedReqHoldTimeMs" scope="global" logging="when_changed" default_value="30" type="integer" persistant="1"></variable>
            <variable _id="id41139632" tag="earlyTimeoutMs" scope="global" logging="when_changed" default_value="200" type="integer" persistant="1"></variable>
            <variable _id="id41139648" tag="itiTimeMs" scope="global" logging="when_changed" default_value="10" type="integer" persistant="1"></variable>
        </folder>
        <folder _id="id41139664" tag="Stimuli">
            <variable _id="id41139669" tag="gratingAzimuthDeg" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1"></variable>
            <variable _id="id41139686" tag="gratingDirectionDeg" scope="global" logging="when_changed" default_value="0" type="integer"></variable>
            <variable _id="id41139700" tag="gratingElevationDeg" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1"></variable>
            <variable _id="id41139716" tag="gratingHeightDeg" scope="global" logging="when_changed" default_value="5" type="integer" persistant="1"></variable>
            <variable _id="id41139732" tag="gratingSpatialFreqCPD" scope="global" logging="when_changed" default_value="0.5" type="integer" persistant="1"></variable>
            <variable _id="id41139748" tag="gratingSpeedDPS" scope="global" logging="when_changed" default_value="1" type="integer" persistant="1"></variable>
            <variable _id="id41139765" tag="gratingWidthDeg" scope="global" logging="when_changed" default_value="10" type="integer" persistant="1"></variable>
        </folder>
        <folder _id="id41139781" tag="Fake Mouse">
            <variable _id="id41139786" tag="doLever" scope="global" logging="when_changed" default_value="1" type="boolean" persistant="1"></variable>
            <variable _id="id41139802" tag="fakeMouseMaxPressMs" scope="global" logging="when_changed" default_value="1000" type="integer" persistant="1"></variable>
            <variable _id="id41139819" tag="fakeMouseMinPressMs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1"></variable>
            <variable _id="id41139835" tag="fakeMouseMinReactMs" scope="global" logging="when_changed" default_value="1300" type="integer" persistant="1"></variable>
            <variable _id="id41139851" tag="fakeMouseMaxReactMs" scope="global" logging="when_changed" default_value="1500" type="integer" persistant="1"></variable>
        </folder>
        <folder _id="id41139867" tag="Task Status">
            <variable _id="id41139873" tag="failure" scope="global" logging="when_changed" default_value="0" type="integer"></variable>
            <variable _id="id41139887" tag="leverResult" scope="global" logging="when_changed" default_value="0" type="boolean"></variable>
            <variable _id="id41139901" tag="stimulusOn" scope="global" logging="when_changed" default_value="0" type="boolean"></variable>
            <variable _id="id41139915" tag="success" scope="global" logging="when_changed" default_value="0" type="integer"></variable>
            <variable _id="id41139929" tag="ignore" scope="global" logging="when_changed" default_value="0" type="integer"></variable>
            <variable _id="id41139943" tag="trialStart" scope="global" logging="when_changed" default_value="0" type="boolean"></variable>
        </folder>
        <folder _id="id41139957" tag="Online Display">
            <variable _id="id41139962" tag="sync" scope="global" logging="when_changed" default_value="0" type="integer"></variable>
        </folder>
        <folder _id="id41139976" tag="Hardware variables">
            <variable _id="id41139982" tag="TTLchannel0" full_name="TTLchannel0" default_value="0" scope="GLOBAL" type="INTEGER" editable="never" logging="when_changed"></variable>
        </folder>
        <folder _id="id41140000" tag="Internal Variables">
            <variable _id="id41140006" tag="tTotalReqHoldTimeMs" scope="global" logging="when_changed" default_value="0" type="integer"></variable>
            <variable _id="id41140020" tag="tRandReqHoldTimeMs" scope="global" logging="when_changed" default_value="0" type="integer"></variable>
            <variable _id="id41140034" tag="tFakeMouseReactMs" scope="global" logging="when_changed" default_value="0" type="integer"></variable>
            <variable _id="id41140048" tag="juice" scope="global" logging="when_changed" default_value="0" type="integer"></variable>
        </folder>
    </variables>
    <sounds _id="id41140062" tag="Sounds">
        <sound _id="id41140068" tag="leverPressSound" type="wav_file" path="wavs/7G.wav"></sound>
        <sound _id="id41140077" tag="stimOnSound" type="wav_file" path="wavs/5C.wav"></sound>
        <sound _id="id41140087" tag="correctSound" type="wav_file" path="wavs/shortCorrect.wav"></sound>
        <sound _id="id41140097" tag="incorrectSound" type="wav_file" path="wavs/incorrectMouse.wav"></sound>
        <sound _id="id41140107" tag="rewardSound" type="wav_file" path="wavs/shortCorrect.wav"></sound>
    </sounds>
    <stimuli _id="id41140117" tag="Stimuli">
        <stimulus _id="id41140122" type="rectangle" tag="testRect" color="1,1,1" x_size="50" y_size="50" x_position="0" y_position="0" rotation="0" contrast="1"></stimulus>
        <stimulus _id="id41140145" type="image_file" tag="imageStimulus" path="images/big-sin-grating-ori90-sf200.png" x_size="40" y_size="40" x_position="0.0" y_position="0.0" rotation="0.0" alpha_multiplier="1.0"></stimulus>
    </stimuli>
    <experiment _id="id41140168" tag="Experiment" full_name="DigitalInExample">
        <protocol _id="id41140175" tag="JuiceOnHoldProtocol" full_name="Protocol" interruptable="YES" selection="sequential_ascending" nsamples="1" sampling_method="cycles" description="" interruptible="YES">
            <trial _id="id41140196" tag="Trial" full_name="Trial" description="" interruptible="1" selection="sequential" nsamples="1000" sampling_method="cycles">
                <task_system _id="id41140214" tag="TS" full_name="TS" interruptable="YES" description="" interruptible="YES">
                    <task_system_state _id="id41140228" tag="Intertrial" interruptible="YES">
                        <action_marker _id="id41140236" _unmoveable="1" tag="Actions"></action_marker>
                        <action _id="id41140244" type="assignment" tag="Set trialStart" variable="trialStart" value="1"></action>
                        <action _id="id41140256" type="assignment" tag="Sync Matlab" variable="sync" value="1"></action>
                        <action _id="id41140267" type="assignment" tag="juice = 0" variable="juice" value="0"></action>
                        <action _id="id41140279" type="assignment" tag="leverResult = 0" variable="leverResult" value="0"></action>
                        <action tag="Start IO Device" type="start_device_IO" device="LabJackU6" _id="_id1"></action>
                        <action _id="id41140301" type="start_timer" tag="Start interTrialTimer" timer="interTrialTimer" timebase="" duration="itiTimeMs" duration_units="ms"></action>
                        <action _id="id41140317" type="assignment" tag="Clear stimulusOn" variable="stimulusOn" value="0"></action>
                        <action _id="id41140329" type="report" tag="Report InterTrial" message="InterTrial"></action>
                        <transition_marker _id="id41140339" _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition _id="id41140347" type="timer_expired" tag="If Expired, Go To WaitForUp" target="WaitForUp" timer="interTrialTimer"></transition>
                    </task_system_state>
                    <task_system_state _id="id41140359" tag="WaitForUp" interruptible="YES">
                        <action_marker _id="id41140366" _unmoveable="1" tag="Actions"></action_marker>
                        <action _id="id41140374" type="report" tag="Report WaitForUp" message="Waiting for release (WaitForUp)"></action>
                        <transition_marker _id="id41140384" _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition _id="id41140392" type="conditional" tag="If LeverUp (and not fakeMouse) go to StartTrial" condition="TTLchannel0 == 0 || doLever == 0 || doWaitForUp == 0" target="StartTrial"></transition>
                    </task_system_state>
                    <task_system_state _id="id41140404" tag="StartTrial" full_name="ReadDigitalIn" description="" interruptible="YES">
                        <action _id="id41140416" type="if" tag="if !fakeMouse" condition="doLever">
                            <action _id="id41140426" type="start_timer" tag="Start Fake Mouse Press Timer infinite" timer="fakeMousePressTimer" timebase="" duration="100000" duration_units="ms"></action>
                        </action>
                        <action _id="id41140442" type="if" tag="if fakeMouse" condition="!doLever">
                            <action _id="id41140452" type="start_timer" tag="Start Fake Mouse Press Timer" timer="fakeMousePressTimer" timebase="" duration="rand(fakeMouseMinPressMs, fakeMouseMaxPressMs)" duration_units="ms"></action>
                        </action>
                        <transition _id="id41140478" type="conditional" tag="If Lever Down, Go To Hold Lever" condition="TTLchannel0 == 1" target="HoldLever"></transition>
                        <transition _id="id41140490" type="timer_expired" tag="If fakeMousePress expired, go to HoldLever" target="HoldLever" timer="fakeMousePressTimer"></transition>
                    </task_system_state>
                    <task_system_state _id="id41140503" tag="HoldLever" interruptible="YES">
                        <action_marker _id="id41140510" _unmoveable="1" tag="Actions"></action_marker>
                        <action _id="id41140518" type="assignment" tag="leverResult = 1" variable="leverResult" value="1"></action>
                        <action _id="id41140530" tag="Play Lever Press Sound" type="play_sound" sound="leverPressSound"></action>
                        <action _id="id41140540" type="assignment" tag="Assign tRandReqHoldTimeMs" variable="tRandReqHoldTimeMs" value="rand(randReqHoldMinMs,randReqHoldMaxMs)"></action>
                        <action _id="id41140552" type="assignment" tag="Assign tTotalReqHoldTimeMs" variable="tTotalReqHoldTimeMs" value="fixedReqHoldTimeMs + tRandReqHoldTimeMs"></action>
                        <action _id="id41140564" type="if" tag="if fakeMouse" condition="!doLever">
                            <action _id="id41140574" type="assignment" tag="Assign tFakeMouseReactMs" variable="tFakeMouseReactMs" value="rand(fakeMouseMinReactMs, fakeMouseMaxReactMs)"></action>
                            <action _id="id41140587" type="start_timer" tag="Start Fake Mouse Timer" timer="fakeMouseTimer" timebase="" duration="tFakeMouseReactMs" duration_units="ms"></action>
                            <action _id="id41140603" tag="Report FakeMouseTimer" full_name="Report Press" type="report" message="fake mouse to react in $tFakeMouseReactMs ms"></action>
                        </action>
                        <action _id="id41140615" type="if" tag="if ! fakeMouse" condition="doLever">
                            <action _id="id41140625" type="start_timer" tag="Start fakeMouseTimer infinite" timer="fakeMouseTimer" timebase="" duration="100000" duration_units="ms"></action>
                        </action>
                        <action _id="id41140641" type="start_timer" tag="Start LeverHold Timer" timer="leverHoldTimer" timebase="" duration="tTotalReqHoldTimeMs" duration_units="ms"></action>
                        <action _id="id41140658" tag="Report LeverDown" full_name="ReportDigital" type="report" message="LeverDown (need to hold for $tTotalReqHoldTimeMs + tooFastTime ms)"></action>
                        <action _id="id41140670" tag="Report TTLchannel0" full_name="ReportDigital" type="report" message="TTLchannel0 == $TTLchannel0"></action>
                        <transition_marker _id="id41140682" _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition _id="id41140690" type="conditional" tag="If Lever Up, Go To EarlyRelease" condition="TTLchannel0 == 0 &amp;&amp; doLever == 1" target="EarlyRelease"></transition>
                        <transition _id="id41140703" type="conditional" tag="Hack - if short hold time, go to StimOn" condition="tTotalReqHoldTimeMs #LT 200" target="StimOn"></transition>
                        <transition _id="id41140715" type="timer_expired" tag="If fakeMouseTimer expired, go to EarlyRelease" target="EarlyRelease" timer="fakeMouseTimer"></transition>
                        <transition _id="id41140727" type="timer_expired" tag="If leverHoldTimer Expired, Go To StimOn" target="StimOn" timer="leverHoldTimer"></transition>
                    </task_system_state>
                    <task_system_state _id="id41140739" tag="StimOn" interruptible="YES">
                        <action_marker _id="id41140747" _unmoveable="1" tag="Actions"></action_marker>
                        <action _id="id41140754" type="assignment" tag="Set StimulusOn" variable="stimulusOn" value="1"></action>
                        <action _id="id41140766" tag="Report StimOn" full_name="ReportDigital" type="report" message="StimOn (still holding; signaling release ok)"></action>
                        <action _id="id41140778" type="start_timer" tag="Start Too Fast Timer" timer="tooFastTimer" timebase="" duration="tooFastTimeMs" duration_units="ms"></action>
                        <action _id="id41140794" type="start_timer" tag="Start React Timer" timer="reactTimeTimer" timebase="" duration="reactTimeMs" duration_units="ms"></action>
                        <action _id="id41140823" tag="Queue Stimulus" type="queue_stimulus" stimulus="imageStimulus"></action>
                        <action _id="id41140844" tag="Update Stimulus" type="update_stimulus_display"></action>
                        <action _id="id41140864" type="if" tag="Conditionally Execute Actions" condition="doAuditoryReleaseStim">
                            <action _id="id41140874" tag="Play stimOnSound" type="play_sound" sound="stimOnSound"></action>
                        </action>
                        <transition_marker _id="id41140884" _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition _id="id41140891" type="direct" tag="Always Go to CheckTooFastTime" target="CheckTooFastTime"></transition>
                    </task_system_state>
                    <task_system_state _id="id41140901" tag="CheckTooFastTime" interruptible="YES">
                        <action_marker _id="id41140909" _unmoveable="1" tag="Actions"></action_marker>
                        <transition_marker _id="id41140929" _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition _id="id41140937" type="timer_expired" tag="if tooFastTimer expired, go to React" target="React" timer="tooFastTimer"></transition>
                        <transition _id="id41140949" type="conditional" tag="If LeverUp, go to EarlyRelease" condition="TTLchannel0 == 0 &amp;&amp; doLever == 1" target="EarlyRelease"></transition>
                        <transition _id="id41140961" type="timer_expired" tag="If fakeMouseTimer expired, go to EarlyRelease" target="EarlyRelease" timer="fakeMouseTimer"></transition>
                    </task_system_state>
                    <task_system_state _id="id41140974" tag="React" interruptible="YES">
                        <action_marker _id="id41140981" _unmoveable="1" tag="Actions"></action_marker>
                        <action _id="id41140989" tag="Report React" full_name="ReportDigital" type="report" message="React"></action>
                        <action _id="id41141000" tag="ReportDigital 4" full_name="ReportDigital" type="report" message="TTLchannel0 = $TTLchannel0"></action>
                        <transition_marker _id="id41141012" _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition _id="id41141020" type="conditional" tag="If Lever Up, Go To Reward" condition="TTLchannel0 == 0 &amp;&amp; doLever == 1" target="Reward"></transition>
                        <transition _id="id41141033" type="timer_expired" tag="If fakeMouse expired, Transition to Reward" target="Reward" timer="fakeMouseTimer"></transition>
                        <transition _id="id41141045" type="timer_expired" tag="If React Time Expired, Go To Failed" target="Failed" timer="reactTimeTimer"></transition>
                    </task_system_state>
                    <task_system_state _id="id41141057" tag="EarlyRelease" interruptible="YES">
                        <action_marker _id="id41141064" _unmoveable="1" tag="Actions"></action_marker>
                        <action _id="id41141072" type="assignment" tag="leverResult = 0" variable="leverResult" value="0"></action>
                        <action _id="id41141084" tag="ReportEarlyRelease" full_name="ReportDigital" type="report" message="** Early Release (TTLchannel0 = $TTLchannel0 )"></action>
                        <action _id="id41141096" type="assignment" tag="failure++" variable="failure" value="failure+1"></action>
                        <action _id="id41141108" tag="Play incorrectSound" type="play_sound" sound="incorrectSound"></action>
                        <action _id="id41141118" type="start_timer" tag="Start earlyTimeoutTimer" timer="earlyTimeoutTimer" timebase="" duration="earlyTimeoutMs" duration_units="ms"></action>
                        <transition_marker _id="id41141134" _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition _id="id41141142" type="timer_expired" tag="If earlyTimeoutTimer expired go to EndTrial" target="EndTrial" timer="earlyTimeoutTimer"></transition>
                    </task_system_state>
                    <task_system_state _id="id41141154" tag="Reward" interruptible="YES">
                        <action_marker _id="id41141162" _unmoveable="1" tag="Actions"></action_marker>
                        <action _id="id41141170" type="assignment" tag="Set LeverUp" variable="leverResult" value="0"></action>
                        <action _id="id41141182" tag="Report Reward" full_name="ReportDigital" type="report" message="** Success"></action>
                        <action _id="id41141193" tag="ReportJuice 4" full_name="ReportDigital" type="report" message="juice= $juice"></action>
                        <action _id="id41141205" type="assignment" tag="success++" variable="success" value="success+1"></action>
                        <action _id="id41141217" type="start_timer" tag="Start juiceTimer" timer="juiceTimer" timebase="" duration="rewardDuration_us+1000" duration_units="us"></action>
                        <action _id="id41141234" type="assignment" tag="Start reward" variable="juice" value="rewardDuration_us"></action>
                        <action _id="id41141246" tag="Play reward sound" type="play_sound" sound="rewardSound"></action>
                        <action _id="id41141255" tag="ReportJuice 5" full_name="ReportDigital" type="report" message="juice= $juice"></action>
                        <transition_marker _id="id41141267" _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition _id="id41141275" type="timer_expired" tag="If juiceTimer expired, go to EndTrial" target="EndTrial" timer="juiceTimer"></transition>
                    </task_system_state>
                    <task_system_state _id="id41141287" tag="Failed" interruptible="YES">
                        <action_marker _id="id41141295" _unmoveable="1" tag="Actions"></action_marker>
                        <action _id="id41141302" type="assignment" tag="failure++" variable="failure" value="failure + 1"></action>
                        <action _id="id41141314" tag="Report Failed" full_name="ReportDigital" type="report" message="** Failed (to respond in time)"></action>
                        <transition_marker _id="id41141326" _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition _id="id41141334" type="direct" tag="Go To EndTrial" target="EndTrial"></transition>
                    </task_system_state>
                    <task_system_state _id="id41141344" tag="EndTrial" interruptible="YES">
                        <action_marker _id="id41141352" _unmoveable="1" tag="Actions"></action_marker>
                        <action tag="Stop IO Device" type="stop_device_IO" device="LabJackU6" _id="_id1"></action>
                        <action _id="id41141369" tag="Dequeue Stimulus 0" type="dequeue_stimulus" stimulus="imageStimulus"></action>
                        <action _id="id41141379" tag="Update Stimulus 2" type="update_stimulus_display"></action>
                        <action _id="id41141387" type="assignment" tag="End Matlab Sync" variable="sync" value="0"></action>
                        <transition_marker _id="id41141399" _unmoveable="1" tag="Transitions"></transition_marker>
                        <transition _id="id41141406" type="direct" tag="Go To Intertrial" target="Intertrial"></transition>
                    </task_system_state>
                </task_system>
            </trial>
        </protocol>
    </experiment>
</monkeyml>