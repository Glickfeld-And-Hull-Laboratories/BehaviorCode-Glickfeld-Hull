<?xml version="1.0"?>
<monkeyml version="1.0">
  <io_devices tag="IO Devices">
    <iodevice tag="LabJackU6" priority="" type="LabJackU6" 
              pulse_duration="juice" pulse_on="juice" 
              lever1="FIO1" 
              lever1_solenoid="MIO0"
              laser_trigger="laserTrigger"
              optic_device="optic_device"
              strobed_digital_word="strobedDigitalWord"
              do_wheelspeed="DoWheelSpeed"
              ws_durationUS="speedIntervalUS"
              wheel_speed="wheelSpeed"
              doCB="doCerebellarStim"
              trial_laser_powerMw="tTrialLaserPowerMw"
              quadrature="quadrature"/>

    <iodevice tag="FakeMonkey" priority="" type="fake_monkey" id="" alt="" spike_rate="10"/>
    <iodevice type="serverside_conduit" tag="Server-side Event Conduit" resource_name="server_conduit"/>
  </io_devices>
  <variables tag="Variables">
    <folder tag="Behavioral Control">
      <variable tag="experimentXmlTrialId" scope="global" logging="when_changed" default_value="8" type="integer" persistant="1"/> <!-- n.b. it is forcibly set each trial below -->
      <variable tag="optic_device" scope="global" logging="when_changed" default_value="led" type="string"/>

      <variable tag="subjectNum" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1" groups="Task Type"/>
      <variable tag="doMatrix" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Task Type"/>
      <variable tag="doRandISITime" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Task Type"/>
      <variable tag="doRandStimOnTime" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Task Type"/>
      <variable tag="doRandCon" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Task Type"/>      
      <variable tag="doRandDir" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Task Type"/>

      <variable tag="doRandPos" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Task Type"/>
      <variable tag="doRandDiameter" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Task Type"/>
      <variable tag="doLogSize" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Task Type"/>
      <variable tag="logSizeN" scope="global" logging="when_changed" default_value="1" type="float" persistant="1" groups="Task Type"/>       
      <variable tag="doRandSF" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Task Type"/>
      <variable tag="doRandTF" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Task Type"/>
      <variable tag="doRandPhase" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Task Type"/>
      <variable tag="doRandSoundAmp" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Task Type"/>
      <variable tag="doWheelSpeed" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Task Type"/>

      <variable tag="doMask" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Mask"/>
      <variable tag="fractMaskTrials" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Mask"/>
      <variable tag="doRandMaskCon" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Mask"/>
      <variable tag="doRandMaskDir" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Mask"/>

      <variable tag="doBlock2" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2"/>
      <variable tag="doBlock2SeparateOdds" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2"/>
      <variable tag="block2TrPer80" scope="global" logging="when_changed" default_value="40" type="float" persistant="1" groups="Block2"/>
      <variable tag="block2MatchB1VisStim" scope="global" logging="when_changed" default_value="1" type="boolean" persistant="1" groups="Block2"/>
      <variable tag="block2MatchB1AudStim" scope="global" logging="when_changed" default_value="1" type="boolean" persistant="1" groups="Block2"/>
      <variable tag="block2DoMatrix" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2"/>
      <variable tag="block2DoRandISITime" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2"/>
      <variable tag="block2DoRandStimOnTime" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2"/>
      <variable tag="block2DoRandCon" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2"/>
      <variable tag="block2DoRandDir" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2"/>
     
      <variable tag="block2DoRandMaskDir" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Mask"/>
      <variable tag="block2DoRandMaskCon" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Mask"/>

      <variable tag="block2DoRandPos" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2"/>
      <variable tag="block2DoRandDiameter" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2"/>
      <variable tag="block2DoRandSF" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2"/>
      <variable tag="block2DoRandTF" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2"/>
      <variable tag="block2DoRandPhase" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2"/>
      <variable tag="block2DoRandSoundAmp" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2"/>

      <variable tag="block2ISITimeMs" scope="global" logging="when_changed" default_value="250" type="float" persistant="1" groups="Block2 Trial Structure"/>
      <variable tag="block2ISITimeN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block2 Trial Structure"/>
      <variable tag="block2ISITimeStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block2 Trial Structure"/>

      <variable tag="itiTimeMs" scope="global" logging="when_changed" default_value="5000" type="float" persistant="1" groups="Trial Structure"/>
      <variable tag="doExtendItiOnShortPrevTrial" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1" groups="Trial Structure"/>
      <variable tag="isiTimeMs" scope="global" logging="when_changed" default_value="250" type="float" persistant="1" groups="Trial Structure"/>
      <variable tag="isiTimeN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Trial Structure"/>
      <variable tag="isiTimeStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Trial Structure"/>

      <variable tag="speedIntervalMS" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Wheel Speed"/>
      <variable tag="wheelSpeed" scope="global" logging="when_changed" default_value="0" type="float" persistant="0" groups="Wheel Speed"/>
      <variable tag="sendElectrophysSync" scope="global" logging="when_changed" default_value="1" type="boolean" persistant="1" groups="Ephys"/>
      <variable tag="sendPClampSync" scope="global" logging="when_changed" default_value="1" type="boolean" persistant="1" groups="Ephys"/>

    </folder>
    <folder tag="Stimuli">

      <variable tag="stimOneDoVisualStim" scope="global" logging="when_changed" default_value="1" type="boolean" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneDoAuditoryStim" scope="global" logging="when_changed" default_value="1" type="boolean" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingOnTimeMs" scope="global" logging="when_changed" default_value="500" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingOnTimeStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingOnTimeStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingContrast" scope="global" logging="when_changed" default_value="1" type="float" persistant="1" groups="Stimulus One Parameters"/>
      
      <variable tag="stimOneGratingContrastStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingContrastSPO" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingContrastStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingDirectionDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingDirectionStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingDirectionStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingElevationDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingElevationStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingElevationStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingAzimuthDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingAzimuthStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingAzimuthStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingDiameterDeg" scope="global" logging="when_changed" default_value="200" type="integer" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingDiameterStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingDiameterStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingDiameterSPO" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingSpatialFreqCPD" scope="global" logging="when_changed" default_value="0.05" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingSpatialFreqStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingSpatialFreqStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingTemporalFreqCPS" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingTemporalFreqStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingTemporalFreqStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingPhaseDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingPhaseStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneGratingPhaseStepDeg" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneSoundAmplitude" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneSoundAmplitudeStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus One Parameters"/>
      <variable tag="stimOneSoundAmplitudeStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus One Parameters"/>

      <variable tag="maskOneGratingContrast" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Mask One Parameters"/>
      <variable tag="maskOneGratingContrastStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Mask One Parameters"/>
      <variable tag="maskOneGratingContrastStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Mask One Parameters"/>
      <variable tag="maskOneGratingDirectionDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Mask One Parameters"/>
      <variable tag="maskOneGratingDirectionStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Mask One Parameters"/>
      <variable tag="maskOneGratingDirectionStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Mask One Parameters"/>

      
      <variable tag="matchStimOneParameters" scope="global" logging="when_changed" default_value="1" type="boolean" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoDoVisualStim" scope="global" logging="when_changed" default_value="1" type="boolean" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoDoAuditoryStim" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingOnTimeMs" scope="global" logging="when_changed" default_value="500" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingOnTimeStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingOnTimeStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingContrast" scope="global" logging="when_changed" default_value="1" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      
      <variable tag="stimTwoGratingContrastStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingContrastStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingDirectionDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingDirectionStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingDirectionStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      
      <variable tag="maskTwoGratingContrast" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Mask Two Parameters"/>
      <variable tag="maskTwoGratingContrastStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Mask Two Parameters"/>
      <variable tag="maskTwoGratingContrastStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Mask Two Parameters"/>
      <variable tag="maskTwoGratingDirectionDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Mask Two Parameters"/>
      <variable tag="maskTwoGratingDirectionStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Mask Two Parameters"/>
      <variable tag="maskTwoGratingDirectionStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Mask Two Parameters"/>
      
      <variable tag="stimTwoGratingElevationDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingElevationStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingElevationStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingAzimuthDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingAzimuthStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingAzimuthStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingDiameterDeg" scope="global" logging="when_changed" default_value="200" type="integer" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingDiameterStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingDiameterStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingSpatialFreqCPD" scope="global" logging="when_changed" default_value="0.05" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingSpatialFreqStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingSpatialFreqStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingTemporalFreqCPS" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingTemporalFreqStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingTemporalFreqStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingPhaseDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingPhaseStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoGratingPhaseStepDeg" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoSoundAmplitude" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoSoundAmplitudeStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Stimulus Two Parameters"/>
      <variable tag="stimTwoSoundAmplitudeStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Stimulus Two Parameters"/>

<!-- stimulus control parameters -->
      
      <!-- block 2 control -->

      <variable tag="block2DoTrialLaser" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block2 Laser"/>
      <variable tag="block2TrialLaserPowerMw" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block2 Laser"/>
      <variable tag="block2TrialLaserOnTimeMs" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block2 Laser"/>
      <variable tag="block2TrialLaserOffTimeMs" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block2 Laser"/>

      <variable tag="block2StimOneDoVisualStim" scope="global" logging="when_changed" default_value="500" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneDoAuditoryStim" scope="global" logging="when_changed" default_value="500" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingOnTimeMs" scope="global" logging="when_changed" default_value="500" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingOnTimeStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingOnTimeStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>

      <variable tag="block2StimOneGratingContrast" scope="global" logging="when_changed" default_value="1" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingContrastStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingContrastStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingDirectionDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingDirectionStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingDirectionStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>

      <variable tag="block2MaskOneGratingContrast" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Mask Parameters"/>
      <variable tag="block2MaskOneGratingContrastStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Mask Parameters"/>
      <variable tag="block2MaskOneGratingContrastStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Mask Parameters"/>
      <variable tag="block2MaskOneGratingDirectionDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Mask Parameters"/>
      <variable tag="block2MaskOneGratingDirectionStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Block 2 Mask Parameters"/>
      <variable tag="block2MaskOneGratingDirectionStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Block 2 Mask Parameters"/>

      <variable tag="block2StimOneGratingElevationDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingElevationStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingElevationStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingAzimuthDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingAzimuthStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingAzimuthStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingDiameterDeg" scope="global" logging="when_changed" default_value="200" type="integer" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingDiameterStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingDiameterStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingSpatialFreqCPD" scope="global" logging="when_changed" default_value="0.05" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingSpatialFreqStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingSpatialFreqStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingTemporalFreqCPS" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingTemporalFreqStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingTemporalFreqStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingPhaseDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingPhaseStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneGratingPhaseStepDeg" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneSoundAmplitude" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneSoundAmplitudeStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>
      <variable tag="block2StimOneSoundAmplitudeStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus One Parameters"/>

      <variable tag="block2MatchStimOneParameters" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoDoVisualStim" scope="global" logging="when_changed" default_value="500" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoDoAuditoryStim" scope="global" logging="when_changed" default_value="500" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingOnTimeMs" scope="global" logging="when_changed" default_value="500" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingOnTimeStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingOnTimeStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>

      <variable tag="block2StimTwoGratingContrast" scope="global" logging="when_changed" default_value="1" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingContrastStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingContrastStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingDirectionDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingDirectionStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingDirectionStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>

      <variable tag="block2MaskTwoGratingContrast" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Mask Parameters"/>
      <variable tag="block2MaskTwoGratingContrastStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Mask Parameters"/>
      <variable tag="block2MaskTwoGratingContrastStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Mask Parameters"/>
      <variable tag="block2MaskTwoGratingDirectionDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Mask Parameters"/>
      <variable tag="block2MaskTwoGratingDirectionStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Block 2 Mask Parameters"/>
      <variable tag="block2MaskTwoGratingDirectionStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Block 2 Mask Parameters"/>

      <variable tag="block2StimTwoGratingElevationDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingElevationStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingElevationStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingAzimuthDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingAzimuthStepN" scope="global" logging="when_changed" default_value="12" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingAzimuthStepDeg" scope="global" logging="when_changed" default_value="30" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingDiameterDeg" scope="global" logging="when_changed" default_value="200" type="integer" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingDiameterStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingDiameterStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingSpatialFreqCPD" scope="global" logging="when_changed" default_value="0.05" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingSpatialFreqStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingSpatialFreqStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingTemporalFreqCPS" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingTemporalFreqStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingTemporalFreqStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingPhaseDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingPhaseStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoGratingPhaseStepDeg" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoSoundAmplitude" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoSoundAmplitudeStepN" scope="global" logging="when_changed" default_value="5" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>
      <variable tag="block2StimTwoSoundAmplitudeStepLog" scope="global" logging="when_changed" default_value="2" type="float" persistant="1" groups="Block 2 Stimulus Two Parameters"/>

      <variable tag="doPhotodiode" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="1" groups="Photodiode Variables"/>
      <variable tag="photoStimulusContrast" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Photodiode Variables"/>
      <variable tag="photoStimulusAzimuth" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1" groups="Photodiode Variables"/>
      <variable tag="photoStimulusElevation" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1" groups="Photodiode Variables"/>
      <variable tag="photoStimulusWidth" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1" groups="Photodiode Variables"/>
      <variable tag="photoStimulusHeight" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1" groups="Photodiode Variables"/>
      <variable tag="photoMaskSpatialFreq" scope="global" logging="when_changed" default_value="0" type="float" persistant="1" groups="Photodiode Variables"/>

    </folder>  
    
    <folder tag="Task Status">
      <variable tag="trialStart" scope="global" logging="when_changed" default_value="0" type="boolean"/>
    </folder>
    <folder tag="Online Display">
      <variable tag="sync" scope="global" logging="when_changed" default_value="0" type="integer"/>
    </folder>
    <folder tag="Hardware variables">
      <variable tag="FIO1" full_name="FIO1" default_value="0" scope="GLOBAL" type="INTEGER" editable="never" logging="when_changed"/>
      <variable tag="MIO0" full_name="MIO0" default_value="0" scope="GLOBAL" type="boolean" editable="never" logging="when_changed"/>
      <variable tag="laserTrigger" full_name="laserTrigger" default_value="0" scope="GLOBAL" type="boolean" logging="when_changed" persistant="0"/>
      <variable tag="strobedDigitalWord" full_name="strobedDigitalWord" default_value="0" scope="GLOBAL" type="integer" logging="when_changed" persistant="0"/>
      <variable tag="juice" full_name="juice" scope="GLOBAL" logging="when_changed" default_value="0" type="integer"/>
      <variable tag="sendLaserParams" full_name="sendLaserParams" scope="GLOBAL" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="sendSerialParams" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="quadrature" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0" />
    </folder>
    <folder tag="Internal Variables">
      <variable tag="ntrials" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tTrialStartMWTimestampMs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tItiWaitTimeMs" scope="global" logging="when_changed" default_value="0" type="integer"/>
      <variable tag="tThisTrialStartTimeMs" scope="global" logging="when_changed" default_value="0" type="integer"/>
      <variable tag="tLastTrialStartTimeMs" scope="global" logging="when_changed" default_value="0" type="integer"/>
      <variable tag="lastTrialTimeMs" scope="global" logging="when_changed" default_value="0" type="integer"/>
      <variable tag="tempMs" scope="global" logging="when_changed" default_value="0" type="integer"/>
      <variable tag="tTempStim1" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tTempStim2" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tTempMask1" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tTempMask2" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="multVal" scope="global" logging="when_changed" default_value="4" type="integer" persistant="0"/>
      <variable tag="tStimulusNumber" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tStimulusNumber2" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tMaskNumber" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tMaskNumber2" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>

      <variable tag="tDoMatrix" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tDoRandISITime" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tDoRandStimOnTime" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tDoRandCon" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>

      <variable tag="tDoMask" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tDoRandMaskCon" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tDoRandDir" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tDoRandMaskDir" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tDoRandPos" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tDoRandDiameter" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tDoRandSF" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tDoRandTF" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tDoRandPhase" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tDoRandSoundAmp" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      
      <variable tag="tStimOneGratingOnTimeMs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tStimTwoGratingOnTimeMs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tISITimeMs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tItiTimeMs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="maxStimOnTime" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="maxISITime" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>

      <variable tag="tStimOneGratingDirectionDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tMaskOneGratingDirectionDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>

      <variable tag="tStimOneGratingContrast" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tMaskOneGratingContrast" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>

      <variable tag="tStimOneGratingElevationDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tStimOneGratingAzimuthDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tStimOneGratingDiameterDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tStimOneGratingSpatialFreqCPD" scope="global" logging="when_changed" default_value="1" type="float" persistant="0"/>
      <variable tag="tStimOneGratingTemporalFreqCPS" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tStimOneGratingPhaseDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tStimOneSoundAmplitude" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      
      <variable tag="tStimTwoGratingDirectionDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tMaskTwoGratingDirectionDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>

      <variable tag="tStimTwoGratingContrast" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tMaskTwoGratingContrast" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>

      <variable tag="tStimTwoGratingElevationDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tStimTwoGratingAzimuthDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tStimTwoGratingDiameterDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tStimTwoGratingSpatialFreqCPD" scope="global" logging="when_changed" default_value="1" type="float" persistant="0"/>
      <variable tag="tStimTwoGratingTemporalFreqCPS" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tStimTwoGratingPhaseDeg" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tStimTwoSoundAmplitude" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>

      <variable tag="tStimOneDoVisualStim" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tStimOneDoAuditoryStim" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tStimTwoDoVisualStim" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="tStimTwoDoAuditoryStim" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>

      <variable tag="tTrialLaserPowerMw" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tTrialLaserOnTimeMs" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tTrialLaserOffTimeMs" scope="global" logging="when_changed" default_value="0" type="float" persistant="0"/>
      <variable tag="tBlock2TrialNumber" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="laserDuration" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="laserDurationMS" scope="global" logging="when_changed" default_value="0" type="integer" persistant="1"/>
      <variable tag="tBlock2TrialLaserPowerMw" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tBlock2TrialLaserOnTimeMs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tBlock2TrialLaserOffTimeMs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>

	    <variable tag="isFirstTrial" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="doCerebellarStim" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="DoWheelSpeed" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>
      <variable tag="speedIntervalUS" scope="global" logging="when_changed" default_value="0" type="boolean" persistant="0"/>

    <variable tag="mwStimOneOnMs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
    <variable tag="mwStimOneOffMs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
    <variable tag="mwStimTwoOnMs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
    <variable tag="mwStimTwoOffMs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
    <variable tag="predictOutputUs" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>    

      <variable tag="tNStimAccepted" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tNStimAccepted2" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tNMaskAccepted" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable tag="tNMaskAccepted2" scope="global" logging="when_changed" default_value="0" type="integer" persistant="0"/>
      <variable type="selection" tag="svStimNumber" values="0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79" 
                selection="random_without_replacement" nsamples="80" sampling_method="samples"/>
      <variable type="selection" tag="svStimNumber2" values="0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79" 
                selection="random_without_replacement" nsamples="80" sampling_method="samples"/>          
      <variable type="selection" tag="svMaskNumber" values="0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79" 
                selection="random_without_replacement" nsamples="80" sampling_method="samples"/>
      <variable type="selection" tag="svMaskNumber2" values="0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79" 
                selection="random_without_replacement" nsamples="80" sampling_method="samples"/>     
    </folder>

  </variables>
  <sounds tag="Sounds">
    <sound tag="stimOneSound" type="wav_file" path="/Users/hullglick/Repositories/BehaviorCode-Glickfeld-Hull/BehaviorCode/NewSkeletonCode/wavs/10000Hz_.2s.wav" amplitude="tStimOneSoundAmplitude"></sound>
    <sound tag="stimTwoSound" type="wav_file" path="/Users/hullglick/Repositories/BehaviorCode-Glickfeld-Hull/BehaviorCode/NewSkeletonCode/wavs/10000Hz_.2s.wav" amplitude="tStimTwoSoundAmplitude"></sound>
  </sounds>
  <stimuli tag="Stimuli">
    <stimulus type="blank_screen" tag="background" color="0.5,0.5,0.5"></stimulus>
    <stimulus type="drifting_grating" tag="stimOne"  direction="0" starting_phase="tStimOneGratingPhaseDeg" 
              spatial_frequency="tStimOneGratingSpatialFreqCPD" 
              speed="tStimOneGratingTemporalFreqCPS/tStimOneGratingSpatialFreqCPD" 
              grating_type="sinusoid" mask="gaussian" std_dev="0.3" mean="0.1" 
              x_size="tStimOneGratingDiameterDeg" y_size="tStimOneGratingDiameterDeg" 
              x_position="tStimOneGratingAzimuthDeg" y_position="tStimOneGratingElevationDeg" 
              rotation="tStimOneGratingDirectionDeg" 
              alpha_multiplier="tStimOneGratingContrast"></stimulus>
    <stimulus type="drifting_grating" tag="stimTwo"  direction="0" starting_phase="tStimTwoGratingPhaseDeg" 
              spatial_frequency="tStimTwoGratingSpatialFreqCPD" 
              speed="tStimTwoGratingTemporalFreqCPS/tStimTwoGratingSpatialFreqCPD" 
              grating_type="sinusoid" mask="gaussian" std_dev="0.3" mean="0.1" 
              x_size="tStimTwoGratingDiameterDeg" y_size="tStimTwoGratingDiameterDeg" 
              x_position="tStimTwoGratingAzimuthDeg" y_position="tStimTwoGratingElevationDeg" 
              rotation="tStimTwoGratingDirectionDeg" 
              alpha_multiplier="tStimTwoGratingContrast"></stimulus>
    <stimulus type="drifting_grating" tag="maskOne"  direction="0" starting_phase="tStimOneGratingPhaseDeg" 
              spatial_frequency="tStimOneGratingSpatialFreqCPD" 
              speed="tStimOneGratingTemporalFreqCPS/tStimOneGratingSpatialFreqCPD" 
              grating_type="sinusoid" mask="gaussian" std_dev="0.3" mean="0.1" 
              x_size="tStimOneGratingDiameterDeg" y_size="tStimOneGratingDiameterDeg" 
              x_position="tStimOneGratingAzimuthDeg" y_position="tStimOneGratingElevationDeg" 
              rotation="tMaskOneGratingDirectionDeg" 
              alpha_multiplier="tMaskOneGratingContrast"></stimulus>
    <stimulus type="drifting_grating" tag="maskTwo"  direction="0" starting_phase="tStimTwoGratingPhaseDeg" 
              spatial_frequency="tStimTwoGratingSpatialFreqCPD" 
              speed="tStimTwoGratingTemporalFreqCPS/tStimTwoGratingSpatialFreqCPD" 
              grating_type="sinusoid" mask="gaussian" std_dev="0.3" mean="0.1" 
              x_size="tStimTwoGratingDiameterDeg" y_size="tStimTwoGratingDiameterDeg" 
              x_position="tStimTwoGratingAzimuthDeg" y_position="tStimTwoGratingElevationDeg" 
              rotation="tMaskTwoGratingDirectionDeg" 
              alpha_multiplier="tMaskTwoGratingContrast"></stimulus>
    <stimulus type="drifting_grating" tag="photoDiodeGrating"  direction="0" starting_phase="0"
              spatial_frequency=".000000000001" 
              speed="0" 
              grating_type="sinusoid" mask="gaussian" std_dev="0.3" mean="0.1" 
              x_size="photoStimulusWidth" y_size="photoStimulusHeight" 
              x_position="photoStimulusAzimuth" y_position="photoStimulusElevation" 
              rotation="0" 
              alpha_multiplier="photoStimulusContrast"></stimulus>
    <stimulus type="drifting_grating" tag="photoDiodeMask"  direction="0" starting_phase="1"
              spatial_frequency="photoMaskSpatialFreq" 
              speed="0" 
              grating_type="sinusoid" mask="gaussian" std_dev="0.3" mean="0.1" 
              x_size="photoStimulusWidth" y_size="photoStimulusHeight" 
              x_position="photoStimulusAzimuth" y_position="photoStimulusElevation" 
              rotation="0" 
              alpha_multiplier="1"></stimulus>                      
  </stimuli>           
  <experiment tag="Experiment" full_name="">
    <protocol tag="JuiceOnHoldProtocol" full_name="" selection="sequential" nsamples="1" sampling_method="cycles" description="" interruptible="YES">
             <!-- init actions run only on first trial after loading experiment -->
        <action type="queue_stimulus" stimulus="background"></action>
        <action type="update_stimulus_display" tag="-"></action>
        <action tag="Start IO Device" type="start_device_IO" device="LabJackU6"></action>

        <action type="if" condition="ntrials == 0">
          <action type="report" message="**** First trial since experiment load - initializing"></action>
          <action type="assignment" variable="tLastTrialStartTimeMs" value="-1"></action>
          <action type="assignment" variable="tThisTrialStartTimeMs" value="-1"></action>
          <action type="assignment" variable="lastTrialTimeMs" value="0"></action>
		      <action type="assignment" variable="isFirstTrial" value="1"></action>
          <!-- reset selection var -->
          <action type="reset_selection" selection="svStimNumber"></action>
          <action type="reset_selection" selection="svStimNumber2"></action>
          <action type="assignment" variable="tNStimAccepted" value="0"></action> 
          <action type="assignment" variable="tNStimAccepted2" value="0"></action> 
          <action type="reset_selection" selection="svMaskNumber"></action>
          <action type="reset_selection" selection="svMaskNumber2"></action>
          <action type="assignment" variable="tNMaskAccepted" value="0"></action> 
          <action type="assignment" variable="tNMaskAccepted2" value="0"></action> 
        </action>

      <trial tag="Trial 01" nsamples="2500" sampling_method="cycles" selection="sequential">
        <task_system tag="TS" full_name="TS" description="" interruptible="YES">
          <task_system_state tag="Initialization" interruptible="YES">
            <action type="if" condition="ntrials > 0">
              <action type="assignment" variable="isFirstTrial" value="0"></action>
            </action>
            <action type="assignment" tag="Sync Matlab" variable="sync" value="1"></action>
            
            <!-- In this state, do all stimulus selection/tValue setting -->
            <action type="report" message="Initializing Trial"/>

            <action type="if" condition="doPhotodiode">
              <action tag="Queue Stimulus" type="live_queue_stimulus" stimulus="photoDiodeMask"></action>
              <action type="play_dynamic_stimulus" stimulus="photoDiodeMask" tag="StimOn"></action> 
              <action type="update_stimulus_display" tag="justincase"></action>
            </action>
            
            <!-- Reset t_____RemainingOn/Off to 0ms -->      
            <action type="assignment" tag="Reset total extra ITI time" variable="tempMs" value="0"></action>
            <action type="assignment" variable="tTrialStartMWTimestampMs" value="now()/1000"></action>  <!-- integer valued ms timestamp -->

            <action type="assignment" tag="Encode START" variable="strobedDigitalWord" value="170"></action>
            <action type="assignment" tag="Encode START" variable="strobedDigitalWord" value="170"></action>
            <action type="assignment" tag="Encode START" variable="strobedDigitalWord" value="170"></action>

            <!--Transmit the trial timestamp so strobed code sequences are unique -->
            <action type="assert" condition="tTrialStartMWTimestampMs &lt;= 2147483648" 
                    message="tTrialStartMWTimestampMs is too large - should happen only after several days of running!?"
                    stop_on_failure="1"/>
            <!-- prevent overflow outside 2**31ms ~ 10 days - I don't know how to get unsigned casts in the XML -->
            <!-- encode trialStartTimestamp in bytes: 4 bytes: millions of seconds, 1000s, s, ms -->
            <action type="assignment" tag="Encode TimestampStart" variable="strobedDigitalWord" value="200"/>
        
            <action type="assignment" tag="Encode TimestampEnd" variable="strobedDigitalWord" value="201"/>

            <action type="assignment" tag="Set trialStart" variable="trialStart" value="1"></action>
            <action type="assignment" variable="experimentXmlTrialId" value="8"></action>

            <!-- choose correct stimulus number based on odds; block2 tr number does not get assigned if ! doBlock2 -->
            <action type="assignment" variable="tStimulusNumber" value="svStimNumber"/>  <!-- choose a value from selection var, 0-origin -->
            <action type="assignment" variable="tStimulusNumber2" value="svStimNumber2"/>  <!-- choose a value from selection var, 0-origin -->
            <action type="assignment" variable="tMaskNumber" value="svMaskNumber"/>  <!-- choose a value from selection var, 0-origin -->
            <action type="assignment" variable="tMaskNumber2" value="svMaskNumber2"/>  <!-- choose a value from selection var, 0-origin -->

            <action type="if" condition="sendPClampSync">
              <action type="assignment" variable="MIO0" value="1"/>
            </action>
                                  
            <action type="if" condition="doBlock2">
              <action type="if" condition="!doBlock2SeparateOdds">
                <action type="assignment" variable="tBlock2TrialNumber" value="tStimulusNumber &lt;= 40"/>
              </action>
              <action type="if" condition="doBlock2SeparateOdds">
                <action type="assignment" variable="tBlock2TrialNumber" value="tStimulusNumber &lt;= block2TrPer80"/>
              </action> 
            </action>    
            <action type="if" condition="!doBlock2">
              <action type="assignment" variable="tBlock2TrialNumber" value="0"/>         
            </action>

            <action type="report" message="tBlock2TrialNumber is $tBlock2TrialNumber"/>

            <!-- set default variables -->
            <action type="assignment" variable="tISITimeMs" value="isiTimeMs"></action>
            <action type="assignment" variable="tStimOneDoVisualStim" value="stimOneDoVisualStim"></action>
            <action type="assignment" variable="tStimOneDoAuditoryStim" value="stimOneDoAuditoryStim"></action>
            <action type="assignment" variable="tStimOneGratingOnTimeMs" value="stimOneGratingOnTimeMs"></action>
            <action type="assignment" variable="tStimOneGratingDirectionDeg" value="stimOneGratingDirectionDeg"></action>
            <action type="assignment" variable="tStimOneGratingContrast" value="stimOneGratingContrast"></action>
            <action type="assignment" variable="tStimOneSoundAmplitude" value="stimOneSoundAmplitude"></action>
            <action type="assignment" variable="tStimOneGratingElevationDeg" value="stimOneGratingElevationDeg"></action>                         
            <action type="assignment" variable="tStimOneGratingAzimuthDeg" value="stimOneGratingAzimuthDeg"></action>                             
            <action type="assignment" variable="tStimOneGratingDiameterDeg" value="stimOneGratingDiameterDeg"></action>                       
            <action type="assignment" variable="tStimOneGratingSpatialFreqCPD" value="stimOneGratingSpatialFreqCPD"></action>
            <action type="assignment" variable="tMaskOneGratingDirectionDeg" value="maskOneGratingDirectionDeg"></action>
            <action type="assignment" variable="tMaskOneGratingContrast" value="maskOneGratingContrast"></action>

            <action type="assignment" variable="tStimOneGratingTemporalFreqCPS" value="stimOneGratingTemporalFreqCPS"></action> 
            <action type="assignment" variable="tStimOneGratingPhaseDeg" value="stimOneGratingPhaseDeg"></action>
            <action type="assignment" variable="tStimTwoDoVisualStim" value="stimTwoDoVisualStim"></action>
            <action type="assignment" variable="tStimTwoDoAuditoryStim" value="stimTwoDoAuditoryStim"></action>

            <action type="assignment" variable="tDoMatrix" value="doMatrix"></action>
            <action type="assignment" variable="tDoRandISITime" value="doRandISITime"></action>
            <action type="assignment" variable="tDoRandStimOnTime" value="doRandStimOnTime"></action>
            <action type="assignment" variable="tDoRandCon" value="doRandCon"></action>
            <action type="assignment" variable="tDoRandDir" value="doRandDir"></action>
            <action type="assignment" variable="tDoRandMaskCon" value="doRandMaskCon"></action>
            <action type="assignment" variable="tDoRandMaskDir" value="doRandMaskDir"></action>
            <action type="assignment" variable="tDoRandPos" value="doRandPos"></action>
            <action type="assignment" variable="tDoRandDiameter" value="doRandDiameter"></action>
            <action type="assignment" variable="tDoRandSF" value="doRandSF"></action>
            <action type="assignment" variable="tDoRandTF" value="doRandTF"></action>                         
            <action type="assignment" variable="tDoRandPhase" value="doRandPhase"></action> 
            <action type="assignment" variable="tDoRandSoundAmp" value="doRandSoundAmp"></action>  

            <action type="if" condition="matchStimOneParameters">
              <action type="assignment" variable="tStimTwoGratingOnTimeMs" value="stimOneGratingOnTimeMs"></action>
              <action type="assignment" variable="tStimTwoGratingDirectionDeg" value="stimOneGratingDirectionDeg"></action>
              <action type="assignment" variable="tStimTwoGratingContrast" value="stimOneGratingContrast"></action>
              <action type="assignment" variable="tStimTwoSoundAmplitude" value="stimOneSoundAmplitude"></action>
              <action type="assignment" variable="tStimTwoGratingElevationDeg" value="stimOneGratingElevationDeg"></action>                      
              <action type="assignment" variable="tStimTwoGratingAzimuthDeg" value="stimOneGratingAzimuthDeg"></action>                           
              <action type="assignment" variable="tStimTwoGratingDiameterDeg" value="stimOneGratingDiameterDeg"></action>                       
              <action type="assignment" variable="tStimTwoGratingSpatialFreqCPD" value="stimOneGratingSpatialFreqCPD"></action>                  
              <action type="assignment" variable="tStimTwoGratingTemporalFreqCPS" value="stimOneGratingTemporalFreqCPS"></action> 
              <action type="assignment" variable="tStimTwoGratingPhaseDeg" value="stimOneGratingPhaseDeg"></action> 
              <action type="assignment" variable="tMaskTwoGratingDirectionDeg" value="maskOneGratingDirectionDeg"></action>
              <action type="assignment" variable="tMaskTwoGratingContrast" value="maskOneGratingContrast"></action>   
            </action>
  
            <action type="if" condition="!matchStimOneParameters">
              <action type="assignment" variable="tStimTwoGratingOnTimeMs" value="stimTwoGratingOnTimeMs"></action>
              <action type="assignment" variable="tStimTwoGratingDirectionDeg" value="stimTwoGratingDirectionDeg"></action>
              <action type="assignment" variable="tStimTwoGratingContrast" value="stimTwoGratingContrast"></action>
              <action type="assignment" variable="tStimTwoSoundAmplitude" value="stimTwoSoundAmplitude"></action>
              <action type="assignment" variable="tStimTwoGratingElevationDeg" value="stimTwoGratingElevationDeg"></action>                      
              <action type="assignment" variable="tStimTwoGratingAzimuthDeg" value="stimTwoGratingAzimuthDeg"></action>                            
              <action type="assignment" variable="tStimTwoGratingDiameterDeg" value="stimTwoGratingDiameterDeg"></action>                       
              <action type="assignment" variable="tStimTwoGratingSpatialFreqCPD" value="stimTwoGratingSpatialFreqCPD"></action>              
              <action type="assignment" variable="tStimTwoGratingTemporalFreqCPS" value="stimTwoGratingTemporalFreqCPS"></action> 
              <action type="assignment" variable="tStimTwoGratingPhaseDeg" value="stimTwoGratingPhaseDeg"></action> 
              <action type="assignment" variable="tMaskTwoGratingDirectionDeg" value="maskTwoGratingDirectionDeg"></action>
              <action type="assignment" variable="tMaskTwoGratingContrast" value="maskTwoGratingContrast"></action>      
            </action>

             <action type="if" condition="doBlock2">
                <action type="if" condition="tBlock2TrialNumber">
                  <action type="if" condition="!block2MatchB1VisStim">
                    <action type="assignment" variable="tDoMatrix" value="block2DoMatrix"></action>
                    <action type="assignment" variable="tDoRandISITime" value="block2DoRandISITime"></action>
                    <action type="assignment" variable="tDoRandStimOnTime" value="block2DoRandStimOnTime"></action>
                    <action type="assignment" variable="tDoRandCon" value="block2DoRandCon"></action>
                    <action type="assignment" variable="tDoRandDir" value="block2DoRandDir"></action>
                    <action type="assignment" variable="tDoRandMaskCon" value="block2DoRandMaskCon"></action>
                    <action type="assignment" variable="tDoRandMaskDir" value="block2DoRandMaskDir"></action>
                    <action type="assignment" variable="tDoRandPos" value="block2DoRandPos"></action>
                    <action type="assignment" variable="tDoRandDiameter" value="block2DoRandDiameter"></action>
                    <action type="assignment" variable="tDoRandSF" value="block2DoRandSF"></action>
                    <action type="assignment" variable="tDoRandTF" value="block2DoRandTF"></action>                         
                    <action type="assignment" variable="tDoRandPhase" value="block2DoRandPhase"></action> 

                    <action type="assignment" variable="tISITimeMs" value="block2ISITimeMs"></action>
                    <action type="assignment" variable="tStimOneDoVisualStim" value="block2StimOneDoVisualStim"></action>
                    <action type="assignment" variable="tStimTwoDoVisualStim" value="block2StimTwoDoVisualStim"></action>
                    <action type="assignment" variable="tStimOneGratingOnTimeMs" value="block2StimOneGratingOnTimeMs"></action>
                    <action type="assignment" variable="tStimOneGratingDirectionDeg" value="block2StimOneGratingDirectionDeg"></action>
                    <action type="assignment" variable="tStimOneGratingContrast" value="block2StimOneGratingContrast"></action>
                    <action type="assignment" variable="tStimOneGratingElevationDeg" value="block2StimOneGratingElevationDeg"></action>                         
                    <action type="assignment" variable="tStimOneGratingAzimuthDeg" value="block2StimOneGratingAzimuthDeg"></action>                             
                    <action type="assignment" variable="tStimOneGratingDiameterDeg" value="block2StimOneGratingDiameterDeg"></action>                       
                    <action type="assignment" variable="tStimOneGratingSpatialFreqCPD" value="block2StimOneGratingSpatialFreqCPD"></action>
                    <action type="assignment" variable="tStimOneGratingTemporalFreqCPS" value="block2StimOneGratingTemporalFreqCPS"></action> 
                    <action type="assignment" variable="tStimOneGratingPhaseDeg" value="block2StimOneGratingPhaseDeg"></action>
                    <action type="assignment" variable="tMaskOneGratingDirectionDeg" value="block2MaskOneGratingDirectionDeg"></action>
                    <action type="assignment" variable="tMaskOneGratingContrast" value="block2MaskOneGratingContrast"></action>


                    <action type="if" condition="block2MatchStimOneParameters">
                      <action type="assignment" variable="tStimTwoGratingDirectionDeg" value="block2StimOneGratingDirectionDeg"></action>
                      <action type="assignment" variable="tStimTwoGratingContrast" value="block2StimOneGratingContrast"></action>
                      <action type="assignment" variable="tStimTwoGratingElevationDeg" value="block2StimOneGratingElevationDeg"></action>                         
                      <action type="assignment" variable="tStimTwoGratingAzimuthDeg" value="block2StimOneGratingAzimuthDeg"></action>                             
                      <action type="assignment" variable="tStimTwoGratingDiameterDeg" value="block2StimOneGratingDiameterDeg"></action>                       
                      <action type="assignment" variable="tStimTwoGratingSpatialFreqCPD" value="block2StimOneGratingSpatialFreqCPD"></action>                             
                      <action type="assignment" variable="tStimTwoGratingTemporalFreqCPS" value="block2StimOneGratingTemporalFreqCPS"></action> 
                      <action type="assignment" variable="tStimTwoGratingPhaseDeg" value="block2StimOneGratingPhaseDeg"></action>  
                      <action type="assignment" variable="tMaskTwoGratingDirectionDeg" value="block2MaskOneGratingDirectionDeg"></action>
                      <action type="assignment" variable="tMaskTwoGratingContrast" value="block2MaskOneGratingContrast"></action>
  
                    </action>

                    <action type="if" condition="!block2MatchStimOneParameters">
                      <action type="assignment" variable="tStimTwoGratingOnTimeMs" value="block2StimTwoGratingOnTimeMs"></action>
                      <action type="assignment" variable="tStimTwoGratingDirectionDeg" value="block2StimTwoGratingDirectionDeg"></action>
                      <action type="assignment" variable="tStimTwoGratingContrast" value="block2StimTwoGratingContrast"></action>
                      <action type="assignment" variable="tStimTwoGratingElevationDeg" value="block2StimTwoGratingElevationDeg"></action>                         
                      <action type="assignment" variable="tStimTwoGratingAzimuthDeg" value="block2StimTwoGratingAzimuthDeg"></action>                             
                      <action type="assignment" variable="tStimTwoGratingDiameterDeg" value="block2StimTwoGratingDiameterDeg"></action>                       
                      <action type="assignment" variable="tStimTwoGratingSpatialFreqCPD" value="block2StimTwoGratingSpatialFreqCPD"></action>                             
                      <action type="assignment" variable="tStimTwoGratingTemporalFreqCPS" value="block2StimTwoGratingTemporalFreqCPS"></action> 
                      <action type="assignment" variable="tStimTwoGratingPhaseDeg" value="block2StimTwoGratingPhaseDeg"></action>    
                      <action type="assignment" variable="tMaskTwoGratingDirectionDeg" value="block2MaskTwoGratingDirectionDeg"></action>
                      <action type="assignment" variable="tMaskTwoGratingContrast" value="block2MaskTwoGratingContrast"></action>
                    </action>
                  </action>

                  <action type="if" condition="!block2MatchB1AudStim">
                    <action type="assignment" variable="tDoMatrix" value="block2DoMatrix"></action>
                    <action type="assignment" variable="tDoRandSoundAmp" value="block2DoRandSoundAmp"></action> 
                    <action type="assignment" variable="tStimOneDoAuditoryStim" value="block2StimOneDoAuditoryStim"></action>
                    <action type="assignment" variable="tStimOneSoundAmplitude" value="block2StimOneSoundAmplitude"></action>
                    <action type="assignment" variable="tStimTwoDoAuditoryStim" value="block2StimTwoDoAuditoryStim"></action>
                    <action type="if" condition="block2MatchStimOneParameters">
                      <action type="assignment" variable="tStimTwoSoundAmplitude" value="block2StimTwoSoundAmplitude"></action>
                    </action> 
                    <action type="if" condition="!block2MatchStimOneParameters">
                      <action type="assignment" variable="tStimTwoSoundAmplitude" value="block2StimOneSoundAmplitude"></action>
                    </action>
                  </action>    

                  <action type="if" condition="block2DoTrialLaser">
                    <action type="assignment" variable="tBlock2TrialLaserPowerMw" value="block2TrialLaserPowerMw"></action>
                    <action type="assignment" variable="tBlock2TrialLaserOnTimeMs" value="block2TrialLaserOnTimeMs"></action>
                    <action type="assignment" variable="tBlock2TrialLaserOffTimeMs" value="block2TrialLaserOffTimeMs"></action>
                  </action> 
                  <action type="if" condition="!block2DoTrialLaser">
                    <action type="assignment" variable="tBlock2TrialLaserPowerMw" value="0"></action>
                    <action type="assignment" variable="tBlock2TrialLaserOnTimeMs" value="0"></action>
                    <action type="assignment" variable="tBlock2TrialLaserOffTimeMs" value="0"></action>
                  </action>  
                </action>
              </action>
              <action type="if" condition="!doBlock2">
                <action type="assignment" variable="tBlock2TrialLaserPowerMw" value="0"></action>
                <action type="assignment" variable="tBlock2TrialLaserOnTimeMs" value="0"></action>
                <action type="assignment" variable="tBlock2TrialLaserOffTimeMs" value="0"></action>
              </action>  

            <!-- single condition calculations -->
            <action type="if" condition="!tDoMatrix">

              <action type="if" condition="tDoRandISITime">
                <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % isiTimeN"/>
                <action type="assignment" variable="tISITimeMs" value= "isiTimeMs * pow(isiTimeStepLog,tTempStim1)"/>
                <action type="if" condition="doBlock2">
                  <action type="if" condition="tBlock2TrialNumber">
                    <action type="if" condition="!block2MatchB1VisStim">
                      <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % block2ISITimeN "/>
                      <action type="assignment" variable="tISITimeMs" value= "block2ISITimeMs + pow(block2ISITimeStepLog,tTempStim1)"/>
                    </action>
                  </action>
                </action> 
              </action> 


              <action type="if" condition="tDoRandStimOnTime">
                <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % stimOneGratingOnTimeStepN"/>
                <action type="assignment" variable="tStimOneGratingOnTimeMs" value= "stimOneGratingOnTimeMs * pow(stimOneGratingOnTimeStepLog,tTempStim1)"/>
                <action type="if" condition="matchStimOneParameters">
                  <action type="assignment" variable="tStimTwoGratingOnTimeMs" value= "tStimOneGratingOnTimeMs"/>
                </action>
                <action type="if" condition="!matchStimOneParameters">
                  <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % stimTwoGratingOnTimeStepN"/>
                  <action type="assignment" variable="tStimTwoGratingOnTimeMs" value= "stimTwoGratingOnTimeMs * pow(stimTwoGratingOnTimeStepLog,tTempStim2)"/>
                </action>
                <action type="if" condition="doBlock2">
                  <action type="if" condition="tBlock2TrialNumber">
                    <action type="if" condition="!block2MatchB1VisStim">
                      <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % block2StimOneGratingOnTimeStepN"/>
                      <action type="assignment" variable="tStimOneGratingOnTimeMs" value= "block2StimOneGratingOnTimeMs * pow(block2StimOneGratingOnTimeStepLog,tTempStim1)"/>
                      <action type="if" condition="block2MatchStimOneParameters">
                        <action type="assignment" variable="tStimTwoGratingOnTimeMs" value= "tStimOneGratingOnTimeMs"/>
                      </action>
                      <action type="if" condition="!block2MatchStimOneParameters">
                        <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % block2StimTwoGratingOnTimeStepN"/>
                        <action type="assignment" variable="tStimTwoGratingOnTimeMs" value= "block2StimTwoGratingOnTimeMs * pow(block2StimTwoGratingOnTimeStepLog,tTempStim2)"/>
                      </action> 
                    </action>
                  </action>
                </action> 
              </action> 

              <action type="if" condition="tDoRandCon">
                <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % stimOneGratingContrastStepN"/>
                <action type="assignment" variable="tStimOneGratingContrast" value= "stimOneGratingContrast * pow(stimOneGratingContrastStepLog,tTempStim1)"/>
                <action type="if" condition="matchStimOneParameters">
                  <action type="assignment" variable="tStimTwoGratingContrast" value= "tStimOneGratingContrast"/>
                </action>
                <action type="if" condition="!matchStimOneParameters">
                  <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % stimTwoGratingContrastStepN"/>
                  <action type="assignment" variable="tStimTwoGratingContrast" value= "stimTwoGratingContrast * pow(stimTwoGratingContrastStepLog,tTempStim2)"/>
                </action>
                <action type="if" condition="doBlock2">
                  <action type="if" condition="tBlock2TrialNumber">
                    <action type="if" condition="!block2MatchB1VisStim">
                      <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % block2StimOneGratingContrastStepN"/>
                      <action type="assignment" variable="tStimOneGratingContrast" value= "block2StimOneGratingContrast * pow(block2StimOneGratingContrastStepLog,tTempStim1)"/>
                      <action type="if" condition="block2MatchStimOneParameters">
                        <action type="assignment" variable="tStimTwoGratingContrast" value= "tStimOneGratingContrast"/>
                      </action>
                      <action type="if" condition="!block2MatchStimOneParameters">
                        <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % block2StimTwoGratingContrastStepN"/>
                        <action type="assignment" variable="tStimTwoGratingContrast" value= "block2StimTwoGratingContrast * pow(block2StimTwoGratingContrastStepLog,tTempStim2)"/>
                      </action> 
                    </action>
                  </action>
                </action> 
              </action> 

              <action type="if" condition="tDoRandDir">
                <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % stimOneGratingDirectionStepN"/>
                <action type="assignment" variable="tStimOneGratingDirectionDeg" value= "stimOneGratingDirectionDeg + (stimOneGratingDirectionStepDeg * (tTempStim1))"/>
                <action type="if" condition="matchStimOneParameters">
                  <action type="assignment" variable="tStimTwoGratingDirectionDeg" value= "tStimOneGratingDirectionDeg"/>
                </action>
                <action type="if" condition="!matchStimOneParameters">
                  <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % stimTwoGratingDirectionStepN"/>
                  <action type="assignment" variable="tStimTwoGratingDirectionDeg" value= "stimTwoGratingDirectionDeg + (stimTwoGratingDirectionStepDeg * (tTempStim2))"/>
                </action>
                <action type="if" condition="doBlock2">
                  <action type="if" condition="tBlock2TrialNumber">
                    <action type="if" condition="!block2MatchB1VisStim">
                      <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % block2StimOneGratingDirectionStepN"/>
                      <action type="assignment" variable="tStimOneGratingDirectionDeg" value= "block2StimOneGratingDirectionDeg + (block2StimOneGratingDirectionStepDeg * (tTempStim1))"/>
                      <action type="if" condition="block2MatchStimOneParameters">
                        <action type="assignment" variable="tStimTwoGratingDirectionDeg" value= "tStimOneGratingDirectionDeg"/>
                      </action>
                      <action type="if" condition="!block2MatchStimOneParameters">
                        <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % block2StimTwoGratingDirectionStepN"/>
                        <action type="assignment" variable="tStimTwoGratingDirectionDeg" value= "block2StimTwoGratingDirectionDeg + (block2StimTwoGratingDirectionStepDeg * (tTempStim2))"/>
                      </action> 
                    </action>
                  </action>
                </action> 
              </action> 

              <action type="if" condition="tDoRandPhase">
                <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % stimOneGratingPhaseStepN"/>
                <action type="assignment" variable="tStimOneGratingPhaseDeg" value= "stimOneGratingPhaseDeg + (stimOneGratingPhaseStepDeg * (tTempStim1))"/>
                <action type="if" condition="matchStimOneParameters">
                  <action type="assignment" variable="tStimTwoGratingPhaseDeg" value= "tStimOneGratingPhaseDeg"/>
                </action>
                <action type="if" condition="!matchStimOneParameters">
                  <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % stimTwoGratingPhaseStepN"/>
                  <action type="assignment" variable="tStimTwoGratingPhaseDeg" value= "stimTwoGratingPhaseDeg + (stimTwoGratingPhaseStepDeg * (tTempStim2))"/>
                </action>
                <action type="if" condition="doBlock2">
                  <action type="if" condition="tBlock2TrialNumber">
                    <action type="if" condition="!block2MatchB1VisStim">
                      <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % block2StimOneGratingPhaseStepN"/>
                      <action type="assignment" variable="tStimOneGratingPhaseDeg" value= "block2StimOneGratingPhaseDeg + (block2StimOneGratingPhaseStepDeg * (tTempStim1))"/>
                      <action type="if" condition="block2MatchStimOneParameters">
                        <action type="assignment" variable="tStimTwoGratingPhaseDeg" value= "tStimOneGratingPhaseDeg"/>
                      </action>
                      <action type="if" condition="!block2MatchStimOneParameters">
                        <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % block2StimTwoGratingPhaseStepN"/>
                        <action type="assignment" variable="tStimTwoGratingPhaseDeg" value= "block2StimTwoGratingPhaseDeg + (block2StimTwoGratingPhaseStepDeg * (tTempStim2))"/>
                      </action> 
                    </action>
                  </action>
                </action> 
              </action>

              <action type="if" condition="tDoRandDiameter">
                <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % stimOneGratingDiameterStepN"/>
                <action type="assignment" variable="tStimOneGratingDiameterDeg" value= "stimOneGratingDiameterDeg * pow(stimOneGratingDiameterStepLog,tTempStim1)"/>
                <action type="if" condition="matchStimOneParameters">
                  <action type="assignment" variable="tStimTwoGratingDiameterDeg" value= "tStimOneGratingDiameterDeg"/>
                </action>
                <action type="if" condition="!matchStimOneParameters">
                  <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % stimTwoGratingDiameterStepN"/>
                  <action type="assignment" variable="tStimTwoGratingDiameterDeg" value= "stimTwoGratingDiameterDeg * pow(stimTwoGratingDiameterStepLog,tTempStim2)"/>
                </action>
                <action type="if" condition="doBlock2">
                  <action type="if" condition="tBlock2TrialNumber">
                    <action type="if" condition="!block2MatchB1VisStim">
                      <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % block2StimOneGratingDiameterStepN"/>
                      <action type="assignment" variable="tStimOneGratingDiameterDeg" value= "block2StimOneGratingDiameterDeg * pow(block2StimOneGratingDiameterStepLog,tTempStim1)"/>
                      <action type="if" condition="block2MatchStimOneParameters">
                        <action type="assignment" variable="tStimTwoGratingDiameterDeg" value= "tStimOneGratingDiameterDeg"/>
                      </action>
                      <action type="if" condition="!block2MatchStimOneParameters">
                        <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % block2StimTwoGratingDiameterStepN"/>
                        <action type="assignment" variable="tStimTwoGratingDiameterDeg" value= "block2StimTwoGratingDiameterDeg * pow(block2StimTwoGratingDiameterStepLog,tTempStim2)"/>
                      </action> 
                    </action>
                  </action>
                </action> 
              </action>

              <action type="if" condition="tDoRandTF">
                <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % stimOneGratingTemporalFreqStepN"/>
                <action type="assignment" variable="tStimOneGratingTemporalFreqCPS" value= "stimOneGratingTemporalFreqCPS * pow(stimOneGratingTemporalFreqStepLog,tTempStim1)"/>
                <action type="if" condition="matchStimOneParameters">
                  <action type="assignment" variable="tStimTwoGratingTemporalFreqCPS" value= "tStimOneGratingTemporalFreqCPS"/>
                </action>
                <action type="if" condition="!matchStimOneParameters">
                  <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % stimTwoGratingTemporalFreqStepN"/>
                  <action type="assignment" variable="tStimTwoGratingTemporalFreqCPS" value= "stimTwoGratingTemporalFreqCPS * pow(stimTwoGratingTemporalFreqStepLog,tTempStim2)"/>
                </action>
                <action type="if" condition="doBlock2">
                  <action type="if" condition="tBlock2TrialNumber">
                    <action type="if" condition="!block2MatchB1VisStim">
                      <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % block2StimOneGratingTemporalFreqStepN"/>
                      <action type="assignment" variable="tStimOneGratingTemporalFreqCPS" value= "block2StimOneGratingTemporalFreqCPS * pow(block2StimOneGratingTemporalFreqStepLog,tTempStim1)"/>
                      <action type="if" condition="block2MatchStimOneParameters">
                        <action type="assignment" variable="tStimTwoGratingTemporalFreqCPS" value= "tStimOneGratingTemporalFreqCPS"/>
                      </action>
                      <action type="if" condition="!block2MatchStimOneParameters">
                        <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % block2StimTwoGratingTemporalFreqStepN"/>
                        <action type="assignment" variable="tStimTwoGratingTemporalFreqCPS" value= "block2StimTwoGratingTemporalFreqCPS * pow(block2StimTwoGratingTemporalFreqStepLog,tTempStim2)"/>
                      </action> 
                    </action>
                  </action>
                </action> 
              </action>     

              <action type="if" condition="tDoRandSF">
                <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % stimOneGratingSpatialFreqStepN"/>
                <action type="assignment" variable="tStimOneGratingSpatialFreqCPD" value= "stimOneGratingSpatialFreqCPD * pow(stimOneGratingSpatialFreqStepLog,tTempStim1)"/>
                <action type="if" condition="matchStimOneParameters">
                  <action type="assignment" variable="tStimTwoGratingSpatialFreqCPD" value= "tStimOneGratingSpatialFreqCPD"/>
                </action>
                <action type="if" condition="!matchStimOneParameters">
                  <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % stimTwoGratingSpatialFreqStepN"/>
                  <action type="assignment" variable="tStimTwoGratingSpatialFreqCPD" value= "stimTwoGratingSpatialFreqCPD * pow(stimTwoGratingSpatialFreqStepLog,tTempStim2)"/>
                </action>
                <action type="if" condition="doBlock2">
                  <action type="if" condition="tBlock2TrialNumber">
                    <action type="if" condition="!block2MatchB1VisStim">
                      <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % block2StimOneGratingSpatialFreqStepN"/>
                      <action type="assignment" variable="tStimOneGratingSpatialFreqCPD" value= "block2StimOneGratingSpatialFreqCPD * pow(block2StimOneGratingSpatialFreqStepLog,tTempStim1)"/>
                      <action type="if" condition="block2MatchStimOneParameters">
                        <action type="assignment" variable="tStimTwoGratingSpatialFreqCPD" value= "tStimOneGratingSpatialFreqCPD"/>
                      </action>
                      <action type="if" condition="!block2MatchStimOneParameters">
                        <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % block2StimTwoGratingSpatialFreqStepN"/>
                        <action type="assignment" variable="tStimTwoGratingSpatialFreqCPD" value= "block2StimTwoGratingSpatialFreqCPD * pow(block2StimTwoGratingSpatialFreqStepLog,tTempStim2)"/>
                      </action> 
                    </action>
                  </action>
                </action> 
              </action> 

              <action type="if" condition="tDoRandSoundAmp">
                <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % stimOneSoundAmplitudeStepN"/>
                <action type="assignment" variable="tStimOneSoundAmplitude" value= "stimOneSoundAmplitude * pow(stimOneSoundAmplitudeStepLog,tTempStim1)"/>
                <action type="if" condition="matchStimOneParameters">
                  <action type="assignment" variable="tStimTwoSoundAmplitude" value= "tStimOneSoundAmplitude"/>
                </action>
                <action type="if" condition="!matchStimOneParameters">
                  <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % stimTwoSoundAmplitudeStepN"/>
                  <action type="assignment" variable="tStimTwoSoundAmplitude" value= "stimTwoSoundAmplitude * pow(stimTwoSoundAmplitudeStepLog,tTempStim2)"/>
                </action>
                <action type="if" condition="doBlock2">
                  <action type="if" condition="tBlock2TrialNumber">
                    <action type="if" condition="!block2MatchB1AudStim">
                      <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % block2StimOneSoundAmplitudeStepN"/>
                      <action type="assignment" variable="tStimOneSoundAmplitude" value= "block2StimOneSoundAmplitude * pow(block2StimOneSoundAmplitudeStepLog,tTempStim1)"/>
                      <action type="if" condition="block2MatchStimOneParameters">
                        <action type="assignment" variable="tStimTwoSoundAmplitude" value= "tStimOneSoundAmplitude"/>
                      </action>
                      <action type="if" condition="!block2MatchStimOneParameters">
                        <action type="assignment" variable="tTempStim2" value= "tStimulusNumber2 % block2StimTwoSoundAmplitudeStepN"/>
                        <action type="assignment" variable="tStimTwoSoundAmplitude" value= "block2StimTwoSoundAmplitude * pow(block2StimTwoSoundAmplitudeStepLog,tTempStim2)"/>
                      </action> 
                    </action>
                  </action>
                </action> 
              </action>

                 <action type="if" condition="tDoRandPos">
                  <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % (stimOneGratingElevationStepN * stimOneGratingAzimuthStepN)"/>    
                  <action type="if" condition="tTempStim1 &lt; stimOneGratingAzimuthStepN">
                    <action type="assignment" variable="tStimOneGratingAzimuthDeg" value= "stimOneGratingAzimuthDeg + (stimOneGratingAzimuthStepDeg * (tTempStim1))"/>
                    <action type="assignment" variable="tStimOneGratingElevationDeg" value= "stimOneGratingElevationDeg"/>
                  </action>
                  <action type="if" condition="tTempStim1 &gt;= stimOneGratingAzimuthStepN">
                    <action type="assignment" variable="tStimOneGratingAzimuthDeg" value= "stimOneGratingAzimuthDeg+ (stimOneGratingAzimuthStepDeg * ((tTempStim1) % stimOneGratingAzimuthStepN))"/>
                    <action type="assignment" variable="tStimOneGratingElevationDeg" value= "stimOneGratingElevationDeg+ (stimOneGratingElevationStepDeg * (floor(tTempStim1 / stimOneGratingAzimuthStepN)))"/>
                  </action>
                  <action type="if" condition="matchStimOneParameters">
                    <action type="assignment" variable="tStimTwoGratingAzimuthDeg" value= "tStimOneGratingAzimuthDeg"/>
                    <action type="assignment" variable="tStimTwoGratingElevationDeg" value= "tStimOneGratingElevationDeg"/>
                  </action>
                  <action type="if" condition="!matchStimOneParameters">
                    <action type="assignment" variable="tTempStim2" value= "tStimulusNumber % (stimTwoGratingElevationStepN * stimTwoGratingAzimuthStepN)"/>    
                    <action type="if" condition="tTempStim1 &lt; stimTwoGratingAzimuthStepN">
                      <action type="assignment" variable="tStimTwoGratingAzimuthDeg" value= "stimTwoGratingAzimuthDeg + (stimTwoGratingAzimuthStepDeg * (tTempStim2))"/>
                      <action type="assignment" variable="tStimTwoGratingElevationDeg" value= "stimTwoGratingElevationDeg"/>
                    </action>
                    <action type="if" condition="tTempStim1 &gt;= stimTwoGratingAzimuthStepN">
                      <action type="assignment" variable="tStimTwoGratingAzimuthDeg" value= "stimTwoGratingAzimuthDeg+ (stimTwoGratingAzimuthStepDeg * ((tTempStim2) % stimTwoGratingAzimuthStepN))"/>
                      <action type="assignment" variable="tStimTwoGratingElevationDeg" value= "stimTwoGratingElevationDeg+ (stimTwoGratingElevationStepDeg * (floor(tTempStim2 / stimTwoGratingAzimuthStepN)))"/>
                    </action>
                  </action>
                  <action type="if" condition="doBlock2">
                  <action type="if" condition="tBlock2TrialNumber">
                    <action type="if" condition="!block2MatchB1VisStim">
                      <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % (block2StimOneGratingElevationStepN * block2StimOneGratingAzimuthStepN)"/>
                      <action type="if" condition="tTempStim1 &lt; block2StimOneGratingAzimuthStepN">
                        <action type="assignment" variable="tStimOneGratingAzimuthDeg" value= "block2StimOneGratingAzimuthDeg + (block2StimOneGratingAzimuthStepDeg * (tTempStim1))"/>
                        <action type="assignment" variable="tStimOneGratingElevationDeg" value= "block2StimOneGratingElevationDeg"/>
                      </action>
                      <action type="if" condition="tTempStim1 &gt;= block2StimOneGratingAzimuthStepN">
                        <action type="assignment" variable="tStimOneGratingAzimuthDeg" value= "block2StimOneGratingAzimuthDeg+ (block2StimOneGratingAzimuthStepDeg * ((tTempStim1) % block2StimOneGratingAzimuthStepN))"/>
                        <action type="assignment" variable="tStimOneGratingElevationDeg" value= "block2StimOneGratingElevationDeg+ (block2StimOneGratingElevationStepDeg * (floor(tTempStim1 / block2StimOneGratingAzimuthStepN)))"/>
                      </action>    
                      <action type="if" condition="block2MatchStimOneParameters">
                        <action type="assignment" variable="tStimTwoGratingAzimuthDeg" value= "tStimOneGratingAzimuthDeg"/>
                        <action type="assignment" variable="tStimTwoGratingElevationDeg" value= "tStimOneGratingElevationDeg"/>
                      </action>
                      <action type="if" condition="!block2MatchStimOneParameters">
                        <action type="assignment" variable="tTempStim2" value= "tStimulusNumber % (block2StimTwoGratingElevationStepN * block2StimTwoGratingAzimuthStepN)"/>    
                        <action type="if" condition="tTempStim1 &lt; block2StimTwoGratingAzimuthStepN">
                          <action type="assignment" variable="tStimTwoGratingAzimuthDeg" value= "block2StimTwoGratingAzimuthDeg + (block2StimTwoGratingAzimuthStepDeg * (tTempStim2))"/>
                          <action type="assignment" variable="tStimTwoGratingElevationDeg" value= "block2StimTwoGratingElevationDeg"/>
                        </action>
                        <action type="if" condition="tTempStim1 &gt;= block2StimTwoGratingAzimuthStepN">
                          <action type="assignment" variable="tStimTwoGratingAzimuthDeg" value= "block2StimTwoGratingAzimuthDeg+ (block2StimTwoGratingAzimuthStepDeg * ((tTempStim2) % block2StimTwoGratingAzimuthStepN))"/>
                          <action type="assignment" variable="tStimTwoGratingElevationDeg" value= "block2StimTwoGratingElevationDeg+ (block2StimTwoGratingElevationStepDeg * (floor(tTempStim2 / block2StimTwoGratingAzimuthStepN)))"/>
                        </action>
                      </action> 
                    </action>
                  </action>
                </action> 
              </action>

            <action type="if" condition="doMask">
                 <action type="assignment" variable="multVal" value="rand(0,1)"/>
                 <action type="if" condition="multVal &gt;= fractMaskTrials">
                    <action type="assignment" variable="tDoMask" value="0"/>
                    <action type="assignment" variable="tMaskOneGratingContrast" value= "0"/>
                    <action type="assignment" variable="tMaskTwoGratingContrast" value= "0"/>
                 </action>
                 <action type="if" condition="multVal &lt; fractMaskTrials">
                    <action type="assignment" variable="tDoMask" value="1"/>
                    
                    <action type="if" condition="tDoRandMaskCon &amp;&amp; !tDoRandMaskDir">
                      <action type="assignment" variable="tTempMask1" value= "tMaskNumber % maskOneGratingContrastStepN"/>
                      <action type="assignment" variable="tMaskOneGratingContrast" value= "maskOneGratingContrast * pow(maskOneGratingContrastStepLog,tTempMask1)"/>
                      <action type="if" condition="matchStimOneParameters">
                        <action type="assignment" variable="tMaskTwoGratingContrast" value= "tMaskOneGratingContrast"/>
                      </action>
                      <action type="if" condition="!matchStimOneParameters">
                        <action type="assignment" variable="tTempMask2" value= "tMaskNumber2 % maskTwoGratingContrastStepN"/>
                        <action type="assignment" variable="tMaskTwoGratingContrast" value= "maskTwoGratingContrast * pow(maskTwoGratingContrastStepLog,tTempMask2)"/>
                      </action>
                      <action type="if" condition="doBlock2">
                        <action type="if" condition="tBlock2TrialNumber">
                          <action type="if" condition="!block2MatchB1VisStim">
                            <action type="assignment" variable="tTempMask1" value= "tMaskNumber % block2MaskOneGratingContrastStepN"/>
                            <action type="assignment" variable="tMaskOneGratingContrast" value= "block2MaskOneGratingContrast * pow(block2MaskOneGratingContrastStepLog,tTempMask1)"/>
                            <action type="if" condition="matchStimOneParameters">
                              <action type="assignment" variable="tMaskTwoGratingContrast" value= "tMaskOneGratingContrast"/>
                            </action>
                            <action type="if" condition="!block2MatchB1VisStim">
                              <action type="assignment" variable="tTempMask2" value= "tMaskNumber2 % block2MaskTwoGratingContrastStepN"/>
                              <action type="assignment" variable="tMaskTwoGratingContrast" value= "block2MaskTwoGratingContrast * pow(block2MaskTwoGratingContrastStepLog,tTempMask2)"/>
                            </action> 
                          </action>
                        </action>
                      </action> 
                    </action> 

                    <action type="if" condition="tDoRandMaskDir &amp;&amp; !tDoRandMaskCon">
                      <action type="assignment" variable="tTempMask1" value= "tMaskNumber % maskOneGratingDirectionStepN"/>
                      <action type="assignment" variable="tMaskOneGratingDirectionDeg" value= "maskOneGratingDirectionDeg + (maskOneGratingDirectionStepDeg * (tTempMask1))"/>
                      <action type="if" condition="matchStimOneParameters">
                        <action type="assignment" variable="tMaskTwoGratingDirectionDeg" value= "tMaskOneGratingDirectionDeg"/>
                      </action>
                      <action type="if" condition="!matchStimOneParameters">
                        <action type="assignment" variable="tTempMask2" value= "tMaskNumber2 % maskTwoGratingDirectionStepN"/>
                        <action type="assignment" variable="tMaskTwoGratingDirectionDeg" value= "maskTwoGratingDirectionDeg + (maskTwoGratingDirectionStepDeg * (tTempMask2))"/>
                      </action>
                      <action type="if" condition="doBlock2">
                        <action type="if" condition="tBlock2TrialNumber">
                          <action type="if" condition="!block2MatchB1VisStim">
                            <action type="assignment" variable="tTempMask1" value= "tMaskNumber % block2MaskOneGratingDirectionStepN"/>
                            <action type="assignment" variable="tMaskOneGratingDirectionDeg" value= "block2MaskOneGratingDirectionDeg + (block2MaskOneGratingDirectionStepDeg * (tTempMask1))"/>
                            <action type="if" condition="block2MatchStimOneParameters">
                              <action type="assignment" variable="tMaskTwoGratingDirectionDeg" value= "tMaskOneGratingDirectionDeg"/>
                            </action>
                            <action type="if" condition="!block2MatchStimOneParameters">
                              <action type="assignment" variable="tTempMask2" value= "tStimulusNumber2 % block2MaskTwoGratingDirectionStepN"/>
                              <action type="assignment" variable="tMaskTwoGratingDirectionDeg" value= "block2MaskTwoGratingDirectionDeg + (block2MaskTwoGratingDirectionStepDeg * (tTempMask2))"/>
                            </action> 
                          </action>
                        </action>
                      </action> 
                    </action> 

                    <action type="if" condition="tDoRandMaskDir &amp;&amp; tDoRandMaskCon">
                      <action type="assignment" variable="tTempMask1" value= "tMaskNumber % (maskOneGratingDirectionStepN * maskOneGratingContrastStepN)"/>
                      <action type="if" condition="tTempMask1 &lt; maskOneGratingDirectionStepN">
                        <action type="assignment" variable="tMaskOneGratingDirectionDeg" value= "maskOneGratingDirectionDeg + (maskOneGratingDirectionStepDeg * (tTempMask1))"/>
                        <action type="assignment" variable="tMaskOneGratingContrast" value= "maskOneGratingContrast"/>
                      </action>
                      <action type="if" condition="tTempMask1 &gt;= maskOneGratingDirectionStepN">
                        <action type="assignment" variable="tMaskOneGratingDirectionDeg" value= "maskOneGratingDirectionDeg+ (maskOneGratingDirectionStepDeg * ((tTempMask1) % maskOneGratingDirectionStepN))"/>
                        <action type="assignment" variable="tMaskOneGratingContrast" value= "maskOneGratingContrast * pow(maskOneGratingContrastStepLog, (floor(tTempMask1 / maskOneGratingDirectionStepN)))"/>
                      </action>
                      <action type="if" condition="matchStimOneParameters">
                        <action type="assignment" variable="tMaskTwoGratingDirectionDeg" value= "tMaskOneGratingDirectionDeg"/>
                        <action type="assignment" variable="tMaskTwoGratingContrast" value= "tMaskOneGratingContrast"/>
                      </action>
                      <action type="if" condition="!matchStimOneParameters">
                        <action type="assignment" variable="tTempMask2" value= "tMaskNumber % (maskTwoGratingDirectionStepN * maskTwoGratingContrastStepN)"/>
                        <action type="if" condition="tTempMask2 &lt; maskTwoGratingDirectionStepN">
                          <action type="assignment" variable="tMaskTwoGratingDirectionDeg" value= "maskTwoGratingDirectionDeg + (maskTwoGratingDirectionStepDeg * (tTempMask2))"/>
                          <action type="assignment" variable="tMaskTwoGratingContrast" value= "maskTwoGratingContrast"/>
                        </action>  
                        <action type="if" condition="tTempMask2 &gt;= maskTwoGratingDirectionStepN">
                          <action type="assignment" variable="tMaskTwoGratingDirectionDeg" value= "maskTwoGratingDirectionDeg+ (maskTwoGratingDirectionStepDeg * ((tTempMask2) % maskTwoGratingDirectionStepN))"/>
                          <action type="assignment" variable="tMaskTwoGratingContrast" value= "maskTwoGratingContrast * pow(maskTwoGratingContrastStepLog, (floor(tTempMask2 / maskTwoGratingDirectionStepN)))"/>
                        </action>  
                      </action>
                      <action type="if" condition="doBlock2">
                        <action type="if" condition="tBlock2TrialNumber">
                          <action type="if" condition="!block2MatchB1VisStim">
                            <action type="assignment" variable="tTempMask1" value= "tMaskNumber % (block2MaskOneGratingDirectionStepN * block2MaskOneGratingContrastStepN)"/>
                            <action type="if" condition="tTempMask1 &lt; block2MaskOneGratingDirectionStepN">
                              <action type="assignment" variable="tMaskOneGratingDirectionDeg" value= "block2MaskOneGratingDirectionDeg + (block2MaskOneGratingDirectionStepDeg * (tTempMask1))"/>
                              <action type="assignment" variable="tMaskOneGratingContrast" value= "block2MaskOneGratingContrast"/>
                            </action>
                            <action type="if" condition="tTempStim1 &gt;= block2MaskOneGratingDirectionStepN">
                              <action type="assignment" variable="tMaskOneGratingDirectionDeg" value= "block2MaskOneGratingDirectionDeg+ (block2MaskOneGratingDirectionStepDeg * ((tTempMask1) % block2MaskOneGratingDirectionStepN))"/>
                              <action type="assignment" variable="tMaskOneGratingContrast" value= "block2MaskOneGratingContrast * pow(block2MaskOneGratingContrastStepLog, (floor(tTempMask1 / block2MaskOneGratingDirectionStepN)))"/>
                            </action>
                            <action type="if" condition="matchStimOneParameters">
                              <action type="assignment" variable="tMaskTwoGratingDirectionDeg" value= "tMaskOneGratingDirectionDeg"/>
                              <action type="assignment" variable="tMaskTwoGratingContrast" value= "tMaskOneGratingContrast"/>
                            </action>
                            <action type="if" condition="!matchStimOneParameters">
                              <action type="assignment" variable="tTempMask2" value= "tStimulusNumber % (block2MaskTwoGratingDirectionStepN * block2MaskTwoGratingContrastStepN)"/>
                              <action type="if" condition="tTempMask2 &lt; block2MaskTwoGratingDirectionStepN">
                                <action type="assignment" variable="tMaskTwoGratingDirectionDeg" value= "block2MaskTwoGratingDirectionDeg + (block2MaskTwoGratingDirectionStepDeg * (tTempMask2))"/>
                                <action type="assignment" variable="tMaskTwoGratingContrast" value= "block2MaskTwoGratingContrast * pow(block2MaskTwoGratingContrastStepLog, (floor(tTempMask2 / block2MaskTwoGratingDirectionStepN)))"/>
                              </action>
                            </action> 
                          </action>
                        </action>
                      </action>
                    </action>
                  </action>
                </action> 
            </action> 

      
            <action type="if" condition="tDoMatrix">
              <action type="if" condition="tDoRandISITime &amp;&amp; tDoRandDir">
                <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % (stimOneGratingDirectionStepN * isiTimeN)"/>
                <action type="if" condition="tTempStim1 &lt; stimOneGratingDirectionStepN">
                  <action type="assignment" variable="tStimOneGratingDirectionDeg" value= "stimOneGratingDirectionDeg + (stimOneGratingDirectionStepDeg * (tTempStim1))"/>
                  <action type="assignment" variable="tISITimeMs" value= "isiTimeMs"/>
                </action>
                <action type="if" condition="tTempStim1 &gt;= stimOneGratingDirectionStepN">
                  <action type="assignment" variable="tStimOneGratingDirectionDeg" value= "stimOneGratingDirectionDeg+ (stimOneGratingDirectionStepDeg * ((tTempStim1) % stimOneGratingDirectionStepN))"/>
                  <action type="assignment" variable="tISITimeMs" value= "isiTimeMs * pow(isiTimeStepLog, (floor(tTempStim1 / stimOneGratingDirectionStepN)))"/>
                </action>
                <action type="if" condition="matchStimOneParameters">
                  <action type="assignment" variable="tStimTwoGratingDirectionDeg" value= "tStimOneGratingDirectionDeg"/>
                </action>
                <action type="if" condition="!matchStimOneParameters">
                  <action type="assignment" variable="tTempStim2" value= "tStimulusNumber % (stimTwoGratingDirectionStepN * isiTimeN)"/>
                  <action type="if" condition="tTempStim2 &lt; stimTwoGratingDirectionStepN">
                    <action type="assignment" variable="tStimTwoGratingDirectionDeg" value= "stimTwoGratingDirectionDeg + (stimTwoGratingDirectionStepDeg * (tTempStim2))"/>
                  </action>  
                  <action type="if" condition="tTempStim2 &gt;= stimTwoGratingDirectionStepN">
                    <action type="assignment" variable="tStimTwoGratingDirectionDeg" value= "stimTwoGratingDirectionDeg+ (stimTwoGratingDirectionStepDeg * ((tTempStim2) % stimTwoGratingDirectionStepN))"/>
                  </action>  
                </action>
                <action type="if" condition="doBlock2">
                  <action type="if" condition="tBlock2TrialNumber">
                    <action type="if" condition="!block2MatchB1VisStim">
                      <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % (block2StimOneGratingDirectionStepN * block2ISITimeN)"/>
                      <action type="if" condition="tTempStim1 &lt; block2StimOneGratingDirectionStepN">
                        <action type="assignment" variable="tStimOneGratingDirectionDeg" value= "block2StimOneGratingDirectionDeg + (block2StimOneGratingDirectionStepDeg * (tTempStim1))"/>
                        <action type="assignment" variable="tISITimeMs" value= "block2ISITimeMs"/>
                      </action>
                      <action type="if" condition="tTempStim1 &gt;= block2StimOneGratingDirectionStepN">
                        <action type="assignment" variable="tStimOneGratingDirectionDeg" value= "block2StimOneGratingDirectionDeg+ (block2StimOneGratingDirectionStepDeg * ((tTempStim1) % block2StimOneGratingDirectionStepN))"/>
                        <action type="assignment" variable="tISITimeMs" value= "block2ISITimeMs * pow(block2ISITimeStepLog, (floor(tTempStim1 / block2StimOneGratingDirectionStepN)))"/>
                      </action>
                      <action type="if" condition="matchStimOneParameters">
                        <action type="assignment" variable="tStimTwoGratingDirectionDeg" value= "tStimOneGratingDirectionDeg"/>
                      </action>
                      <action type="if" condition="!matchStimOneParameters">
                        <action type="assignment" variable="tTempStim2" value= "tStimulusNumber % (block2StimTwoGratingDirectionStepN * block2ISITimeN)"/>
                        <action type="if" condition="tTempStim2 &lt; block2StimTwoGratingDirectionStepN">
                          <action type="assignment" variable="tStimTwoGratingDirectionDeg" value= "block2StimTwoGratingDirectionDeg + (block2StimTwoGratingDirectionStepDeg * (tTempStim2))"/>
                        </action>
                      </action> 
                    </action>
                  </action>
                </action>
              </action>

              <action type="if" condition="tDoRandCon &amp;&amp; tDoRandDiameter">
                <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % (stimOneGratingContrastStepN * stimOneGratingDiameterStepN)"/>
                <action type="if" condition="tTempStim1 &lt; stimOneGratingContrastStepN">
                  <action type="assignment" variable="tStimOneGratingContrast" value= "stimOneGratingContrast * pow(stimOneGratingContrastSPO,tTempStim1)"/>
                  <action type="assignment" variable="tStimOneGratingDiameterDeg" value= "stimOneGratingDiameterDeg"/>
                </action>
                <action type="if" condition="tTempStim1 &gt;= stimOneGratingContrastStepN">
                  <action type="assignment" variable="tStimOneGratingContrast" value= "stimOneGratingContrast* pow(stimOneGratingContrastSPO, ((tTempStim1) % stimOneGratingContrastStepN))"/>
                  <action type="assignment" variable="tStimOneGratingDiameterDeg" value= "tStimOneGratingDiameterDeg * pow(stimOneGratingDiameterSPO, (floor(tTempStim1 / stimOneGratingDiameterStepN)))"/>
                </action>
                <action type="if" condition="matchStimOneParameters">
                  <action type="assignment" variable="tStimTwoGratingContrast" value= "tStimOneGratingContrast"/>
                  <action type="assignment" variable="tStimTwoGratingDiameterDeg" value= "tStimOneGratingDiameterDeg"/>
                </action>


                <!--
                <action type="if" condition="!matchStimOneParameters">
                  <action type="assignment" variable="tTempStim2" value= "tStimulusNumber % (stimTwoGratingDirectionStepN * isiTimeN)"/>
                  <action type="if" condition="tTempStim2 &lt; stimTwoGratingDirectionStepN">
                    <action type="assignment" variable="tStimTwoGratingDirectionDeg" value= "stimTwoGratingDirectionDeg + (stimTwoGratingDirectionStepDeg * (tTempStim2))"/>
                  </action>  
                  <action type="if" condition="tTempStim2 &gt;= stimTwoGratingDirectionStepN">
                    <action type="assignment" variable="tStimTwoGratingDirectionDeg" value= "stimTwoGratingDirectionDeg+ (stimTwoGratingDirectionStepDeg * ((tTempStim2) % stimTwoGratingDirectionStepN))"/>
                  </action>  
                </action>
                <action type="if" condition="doBlock2">
                  <action type="if" condition="tBlock2TrialNumber">
                    <action type="if" condition="!block2MatchB1VisStim">
                      <action type="assignment" variable="tTempStim1" value= "tStimulusNumber % (block2StimOneGratingDirectionStepN * block2ISITimeN)"/>
                      <action type="if" condition="tTempStim1 &lt; block2StimOneGratingDirectionStepN">
                        <action type="assignment" variable="tStimOneGratingDirectionDeg" value= "block2StimOneGratingDirectionDeg + (block2StimOneGratingDirectionStepDeg * (tTempStim1))"/>
                        <action type="assignment" variable="tISITimeMs" value= "block2ISITimeMs"/>
                      </action>
                      <action type="if" condition="tTempStim1 &gt;= block2StimOneGratingDirectionStepN">
                        <action type="assignment" variable="tStimOneGratingDirectionDeg" value= "block2StimOneGratingDirectionDeg+ (block2StimOneGratingDirectionStepDeg * ((tTempStim1) % block2StimOneGratingDirectionStepN))"/>
                        <action type="assignment" variable="tISITimeMs" value= "block2ISITimeMs * pow(block2ISITimeSPO, (floor(tTempStim1 / block2StimOneGratingDirectionStepN)))"/>
                      </action>
                      <action type="if" condition="matchStimOneParameters">
                        <action type="assignment" variable="tStimTwoGratingDirectionDeg" value= "tStimOneGratingDirectionDeg"/>
                      </action>
                      <action type="if" condition="!matchStimOneParameters">
                        <action type="assignment" variable="tTempStim2" value= "tStimulusNumber % (block2StimTwoGratingDirectionStepN * block2ISITimeN)"/>
                        <action type="if" condition="tTempStim2 &lt; block2StimTwoGratingDirectionStepN">
                          <action type="assignment" variable="tStimTwoGratingDirectionDeg" value= "block2StimTwoGratingDirectionDeg + (block2StimTwoGratingDirectionStepDeg * (tTempStim2))"/>
                        </action>
                      </action> 
                    </action>
                  </action>
                </action> -->
              </action>
            </action> 
            

            <action type="if" condition="!tStimOneDoVisualStim">
              <action type="assignment" variable="tStimOneGratingContrast" value= "0"/>
              <action type="assignment" variable="tMaskOneGratingContrast" value= "0"/>
            </action> 

            <action type="if" condition="!tStimTwoDoVisualStim">
              <action type="assignment" variable="tStimTwoGratingContrast" value= "0"/>
              <action type="assignment" variable="tMaskTwoGratingContrast" value= "0"/>
            </action>

            <action type="if" condition="!tStimOneDoAuditoryStim">
              <action type="assignment" variable="tStimOneSoundAmplitude" value= "0"/>
            </action> 
            <action type="if" condition="!tStimTwoDoAuditoryStim">
              <action type="assignment" variable="tStimTwoSoundAmplitude" value= "0"/>
            </action>

            <action type="if" condition="tStimOneGratingContrast &gt; 1">
              <action type="assignment" variable="tStimOneGratingContrast" value= "1"/>
            </action>
            <action type="if" condition="tMaskOneGratingContrast &gt; 1">
              <action type="assignment" variable="tMaskOneGratingContrast" value= "1"/>
            </action> 
            <action type="if" condition="tStimTwoGratingContrast &gt; 1">
              <action type="assignment" variable="tStimTwoGratingContrast" value= "1"/>
            </action>
            <action type="if" condition="tMaskTwoGratingContrast &gt; 1">
              <action type="assignment" variable="tMaskTwoGratingContrast" value= "1"/>
            </action>

            <action type="if" condition="tStimOneGratingContrast &lt; 0">
              <action type="assignment" variable="tStimOneGratingContrast" value= "0"/>
            </action>
            <action type="if" condition="tMaskOneGratingContrast &lt; 0">
              <action type="assignment" variable="tMaskOneGratingContrast" value= "0"/>
            </action> 
            <action type="if" condition="tStimTwoGratingContrast &lt; 0">
              <action type="assignment" variable="tStimTwoGratingContrast" value= "0"/>
            </action>
            <action type="if" condition="tMaskTwoGratingContrast &lt; 0">
              <action type="assignment" variable="tMaskTwoGratingContrast" value= "0"/>
            </action>

            <action type="if" condition="tDoMask">
               <action type="if" condition="tStimOneGratingContrast + tMaskOneGratingContrast &gt; 1">
                  <action type="assignment" variable="tMaskOneGratingContrast" value= "0"/>
                </action> 
                <action type="if" condition="tStimTwoGratingContrast + tMaskTwoGratingContrast &gt; 1">
                  <action type="assignment" variable="tMaskTwoGratingContrast" value= "0"/>
                </action>  
            </action>

            <action type="if" condition="!tDoMask">
              <action type="assignment" variable="tMaskOneGratingContrast" value= "0"/>
              <action type="assignment" variable="tMaskTwoGratingContrast" value= "0"/>
            </action>

            <action type="report" message="tStimOneGratingContrast is $tStimOneGratingContrast; tMaskOneGratingContrast is $tMaskOneGratingContrast"></action>
            <action type="report" message="tStimOneGratingDirectionDeg is $tStimOneGratingDirectionDeg; tMaskOneGratingDirectionDeg is $tMaskOneGratingDirectionDeg"></action>

            <action type="assignment" 
            variable="tItiTimeMs" 
            value="itiTimeMs"></action>

            <action type="start_timer" timer="InterTrialTimer" duration="tItiTimeMs" timebase="" duration_units="ms" />
            
            <!-- initialize trial start/end times -->
            <action type="if" condition="tThisTrialStartTimeMs == -1">  
              <!--first trial, leave lasttime as -1 -->
              <action type="assignment" variable="tLastTrialStartTimeMs" value="-1"></action>
            </action>
            <action type="if" condition="tThisTrialStartTimeMs != -1">  <!--else-->
              <!--later trials, copy this into last before setting this again below -->9
              <action type="assignment" variable="tLastTrialStartTimeMs" value="tThisTrialStartTimeMs"></action>
            </action>
            <action type="assignment" variable="tThisTrialStartTimeMs" value="now()/1000"></action>

            <!-- compute ITI time -->
            <!-- initialize with a const value -->
            <action type="assignment" variable="tItiWaitTimeMs" value="itiTimeMs"></action>
            
            <action type="if" condition="tDoRandStimOnTime">
              <action type="assignment" variable="maxStimOnTime"  
                      value="(stimOneGratingOnTimeMs * pow(stimOneGratingOnTimeStepLog,stimOneGratingOnTimeStepN)) + (stimTwoGratingOnTimeMs * pow(stimTwoGratingOnTimeStepLog,stimTwoGratingOnTimeStepN))"/>
            </action>  

            <action type="if" condition="!tDoRandStimOnTime">
              <action type="assignment" variable="maxStimOnTime"  
                      value="stimOneGratingOnTimeMs + stimTwoGratingOnTimeMs"/>
            </action> 

            <action type="if" condition="tDoRandISITime">
              <action type="assignment" variable="maxISITime"  
                      value="isiTimeMs * pow(isiTimeStepLog,isiTimeN-1)"/>
            </action>  

            <action type="if" condition="!tDoRandISITime">
              <action type="assignment" variable="maxISITime" 
                      value="isiTimeMs"/>
            </action>

            
            <action type="if" condition="sendPClampSync"> 
                <action type="assignment" variable="tempMs" value="maxISITime-tISITimeMs"/>
            </action>

            <action type="report" message="maxISI is $maxISITime"/>

            <action type="if" condition="doExtendItiOnShortPrevTrial == 1"> 
              <action type="if" condition="!isFirstTrial"> 
                <action type="assignment" variable="tempMs"  
                     value="(maxStimOnTime+maxISITime)-lastTrialTimeMs"/> 
                <action type="assignment" tag="-" variable="tItiWaitTimeMs" value="itiTimeMs+tempMs"></action>
              </action>
            </action>

            
            <action type="assignment" tag="Encode ItiStart" variable="strobedDigitalWord" value="6"></action>

            <action type="if" condition="doWheelSpeed == 1">
              <action type="assignment" variable="doCerebellarStim" value="0"/>
              <action type="assignment" variable="DoWheelSpeed" value="doWheelSpeed"/>
              <action type="assignment" variable="speedIntervalUS" value="speedIntervalMS*1000"/>
            </action>

            <action type="assignment" variable="MIO0" value="0"></action>

            <action type="report" message="In ITI, waiting $tItiWaitTimeMs, then wait for press"></action>
			
          <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
            <transition type="conditional" tag="Queue Visual Stimulus" condition="timerExpired(InterTrialTimer)" target="StimOneOn"></transition>


          </task_system_state>

          
                
                  
          <task_system_state tag="StimOneOn" interruptible="YES">
            
            <!-- if trialLaser, send params to controller -->
            <action type="report" message="in stim on"/>
            <action type="if" condition="tBlock2TrialNumber &amp;&amp; block2DoTrialLaser">
              <action type="report" message="send laser params"></action>
              <action type="assignment" tag="Send laser params to controller" variable="sendLaserParams" value="1"></action>
              <action type="assignment" tag="Send laser params to controller" variable="sendLaserParams" value="0"></action>
            </action>

            <action type="if" condition="tBlock2TrialNumber &amp;&amp; block2DoTrialLaser">
              <action type="assignment" tag="set trial laser power" variable="tTrialLaserPowerMw" value="tBlock2TrialLaserPowerMw"></action>
              <action type="report" message="Block2 is on; tTrialLaserPowerMw is $tTrialLaserPowerMw"></action>
            </action>  
            <action type="if" condition="!tBlock2TrialNumber || !block2DoTrialLaser">
              <action type="assignment" tag="set trial laser power" variable="tTrialLaserPowerMw" value="0"></action>
            </action> 

            <action_marker _unmoveable="1" tag="Actions"></action_marker>

            <action type="if" condition="tTrialLaserPowerMw > 0">
                <action type="if" condition="optic_device == 'led' ">
                    <action type="assignment" variable="laserTrigger" value="1"></action>
                </action>
                <action type="if" condition="optic_device != 'led' ">
                    <action type="assignment" variable="laserTrigger" value="1"></action>
                </action>
                <action type="assignment" variable="laserDuration" value="laserDurationMS"/>
                <action type="report" message="-----Laser Duration is to $laserDuration"/>
              <action type="report" message="********* SENDING LASER TRIGGER *********"/>
              <action type="assignment" tag="Encode LaserStimOn" variable="strobedDigitalWord" value="5"></action>
            </action>

            <action type="assignment" variable="ntrials" value="ntrials + 1"/>

          	<action tag="Queue Stimulus" type="live_queue_stimulus" stimulus="stimOne"></action> 
          	<action type="play_dynamic_stimulus" stimulus="stimOne" tag="StimOn"></action>
            <action type="if" condition="doMask">
              <action tag="Queue Stimulus" type="live_queue_stimulus" stimulus="maskOne"></action> 
              <action type="play_dynamic_stimulus" stimulus="maskOne" tag="StimOn"></action>
            </action>
            <action type="if" condition="doPhotodiode">
              <action tag="Queue Stimulus" type="live_queue_stimulus" stimulus="photoDiodeGrating"></action>
              <action tag="Dequeue Stimulus" type="dequeue_stimulus" stimulus="photoDiodeMask"></action> 
              <action type="play_dynamic_stimulus" stimulus="photoDiodeGrating" tag="StimOn"></action>
            </action>
            <action type="update_stimulus_display" tag="justincase" predicted_output_time="predictOutputUs"></action>
            <action type="start_timer" timer="stimTimer" timebase="" duration="tStimOneGratingOnTimeMs" duration_units="ms"/>

            <action type="play_sound" sound="stimOneSound"/>
            <action type="assignment" variable="mwStimOneOnMs" value="now()/1000" />
            <action type="if" condition="sendElectrophysSync">
              <action type="assignment" variable="MIO0" value="1"/>
            </action>

            <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
            <transition type="conditional" tag="Dequeue Visual Stimulus" condition="timerExpired(stimTimer)" target="StimOneOff"></transition>

          </task_system_state>

          <task_system_state tag="StimOneOff" interruptible="YES"> 

            <action_marker _unmoveable="1" tag="Actions"></action_marker>

            <action type="start_timer" timer="ISItimer" timebase="" duration="tISITimeMs" duration_units="ms"/>


            <action type="dequeue_stimulus" stimulus="stimOne"></action>
            <action type="dequeue_stimulus" stimulus="maskOne"></action>
            <action type="if" condition="doPhotodiode">
              <action tag="dequeue Stimulus" type="dequeue_stimulus" stimulus="photoDiodeGrating"></action>
              <action tag="Queue Stimulus" type="live_queue_stimulus" stimulus="photoDiodeMask"></action>
              <action type="play_dynamic_stimulus" stimulus="photoDiodeMask" tag="StimOn"></action>  
            </action>
            <action tag="Update Stimulus" type="update_stimulus_display"></action>
            
            <action type="assignment" variable="mwStimOneOffMs" value="(now()/1000)" />

            <action type="if" condition="sendElectrophysSync">
              <action type="assignment" variable="MIO0" value="0"/>
            </action>
            
            <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
            <transition type="conditional" tag="Queue Visual Stimulus" condition="timerExpired(ISItimer) &amp;&amp; tStimTwoGratingContrast &gt; 0" target="StimTwoOn"></transition>
            <transition type="conditional" tag="Queue Visual Stimulus" condition="tStimTwoGratingContrast == 0" target="EndTrial"></transition>

          </task_system_state>
          
          <task_system_state tag="StimTwoOn" interruptible="YES">
            <action_marker _unmoveable="1" tag="Actions"></action_marker>

            <action type="start_timer" timer="stimTimer" timebase="" duration="tStimTwoGratingOnTimeMs" duration_units="ms"/>

            <action tag="Queue Stimulus" type="live_queue_stimulus" stimulus="stimTwo"></action> 
            <action type="play_dynamic_stimulus" stimulus="stimTwo" tag="StimOn"></action>
            <action type="if" condition="doMask"> 
              <action tag="Queue Stimulus" type="live_queue_stimulus" stimulus="maskTwo"></action>  
              <action type="play_dynamic_stimulus" stimulus="maskTwo" tag="StimOn"></action>
            </action>
            <action type="if" condition="doPhotodiode">
              <action tag="Queue Stimulus" type="live_queue_stimulus" stimulus="photoDiodeGrating"></action>
              <action tag="Dequeue Stimulus" type="dequeue_stimulus" stimulus="photoDiodeMask"></action> 
              <action type="play_dynamic_stimulus" stimulus="photoDiodeGrating" tag="StimOn"></action>
            </action>
            <action type="update_stimulus_display" tag="justincase"></action>
            <action type="play_sound" sound="stimTwoSound"/>
            <action type="assignment" variable="mwStimTwoOnMs" value="now()/1000" />

            <action type="if" condition="sendElectrophysSync">
              <action type="assignment" variable="MIO0" value="1"/>
            </action>

            <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
            <transition type="conditional" tag="Dequeue Visual Stimulus" condition="timerExpired(stimTimer)" target="StimTwoOff"></transition>
          </task_system_state>

          <task_system_state tag="StimTwoOff" interruptible="YES">
            <action_marker _unmoveable="1" tag="Actions"></action_marker>
            <action type="if" condition="sendPClampSync">
              <action type="start_timer" timer="stimOffTimer" timebase="" duration="tempMs+500" duration_units="ms"/>
              <action type="report" message="time is $tempMs"/>
            </action>
            <action type="if" condition="!sendPClampSync">
              <action type="start_timer" timer="stimOffTimer" timebase="" duration="100" duration_units="ms"/>
            </action>

            <action type="dequeue_stimulus" stimulus="stimTwo"></action>
            <action type="dequeue_stimulus" stimulus="maskTwo"></action>
            <action type="if" condition="doPhotodiode">
              <action tag="dequeue Stimulus" type="dequeue_stimulus" stimulus="photoDiodeGrating"></action>
              <action tag="Queue Stimulus" type="live_queue_stimulus" stimulus="photoDiodeMask"></action>
              <action type="play_dynamic_stimulus" stimulus="photoDiodeMask" tag="StimOn"></action>  
            </action>
            <action tag="Update Stimulus" type="update_stimulus_display"></action>
            
            <action type="assignment" variable="mwStimTwoOffMs" value="(now()/1000)" />

            <action type="if" condition="sendElectrophysSync">
              <action type="assignment" variable="MIO0" value="0"/>
            </action>

            <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
            <transition type="conditional" tag="Queue Visual Stimulus" condition="!sendPClampSync &amp;&amp; timerExpired(stimOffTimer)" target="EndTrial"></transition>
            <transition type="conditional" tag="Queue Visual Stimulus" condition="sendPClampSync &amp;&amp; timerExpired(stimOffTimer)" target="LaserOff"></transition>
          </task_system_state>

          <task_system_state tag="LaserOff" interruptible="YES">
            <action_marker _unmoveable="1" tag="Actions"></action_marker>

            <action type="if" condition="laserTrigger"> 
              <action type="if" condition="optic_device == 'led' ">
                  <action type="assignment" variable="laserTrigger" value="0"></action>
                  <action type="assignment" variable="tTrialLaserPowerMw" value="0"></action>
              </action>
              <action type="if" condition="optic_device != 'led' ">
                  <action type="assignment" variable="laserTrigger" value="0"></action>
              </action>
              <action type="report" message="********* Turning off LASER TRIGGER *********"/>
            </action>

            <action type="start_timer" timer="laserOffTimer" timebase="" duration="700" duration_units="ms"/>

          <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
            <transition type="conditional" tag="Queue Visual Stimulus" condition="timerExpired(laserOffTimer)" target="EndTrial"></transition>
          </task_system_state>

          <task_system_state tag="EndTrial" interruptible="YES">
            <action type="report" message="Trial Ended"/>
            <!-- accept stim selection -->
            <action type="accept_selections" selection="svStimNumber"></action>
            <action type="assignment" variable="tNStimAccepted" value="tNStimAccepted + 1"></action>

            <!-- update selection variable -->
            <action type="if" condition="tNStimAccepted &gt;= 80">
              <action type="reset_selection" selection="svStimNumber"/>
              <action type="assignment" variable="tNStimAccepted" value="0"></action>
              <action type="report" message="Should be resetting selections,tNStimAccepted=$tNStimAccepted"/>
            </action>
            <action type="if" condition="tNStimAccepted &lt; 80">
              <action type="next_selection" selection="svStimNumber"/>
              <action type="report" message="Next selection,tNStimAccepted=$tNStimAccepted"/>
            </action>

            <action type="accept_selections" selection="svStimNumber2"></action>
            <action type="assignment" variable="tNStimAccepted2" value="tNStimAccepted2 + 1"></action>

            <!-- update selection variable -->
            <action type="if" condition="tNStimAccepted2 &gt;= 80">
              <action type="reset_selection" selection="svStimNumber2"/>
              <action type="assignment" variable="tNStimAccepted2" value="0"></action>
            </action>
            <action type="if" condition="tNStimAccepted2 &lt; 80">
              <action type="next_selection" selection="svStimNumber2"/>
            </action>

            <action type="accept_selections" selection="svMaskNumber"></action>
            <action type="assignment" variable="tNMaskAccepted" value="tNMaskAccepted + 1"></action>

            <!-- update selection variable -->
            <action type="if" condition="tNMaskAccepted &gt;= 80">
              <action type="reset_selection" selection="svMaskNumber"/>
              <action type="assignment" variable="tNMaskAccepted" value="0"></action>
            </action>
            <action type="if" condition="tNMaskAccepted &lt; 80">
              <action type="next_selection" selection="svMaskNumber"/>
            </action>

            <action type="accept_selections" selection="svMaskNumber2"></action>
            <action type="assignment" variable="tNMaskAccepted2" value="tNMaskAccepted2 + 1"></action>

            <!-- update selection variable -->
            <action type="if" condition="tNMaskAccepted2 &gt;= 80">
              <action type="reset_selection" selection="svMaskNumber2"/>
              <action type="assignment" variable="tNMaskAccepted2" value="0"></action>
            </action>
            <action type="if" condition="tNMaskAccepted2 &lt; 80">
              <action type="next_selection" selection="svMaskNumber2"/>
            </action>

            <action type="if" condition="doWheelSpeed == 1">
              <action type="assignment" variable="DoWheelSpeed" value="0"/>
            </action>
            <action type="assignment" tag="End Matlab Sync" variable="sync" value="0"></action>
            <transition_marker _unmoveable="1" tag="Transitions"></transition_marker>
            <transition type="yield" tag="return to parent task system"></transition>
          </task_system_state>

        </task_system>
      </trial>
      <action type="assignment" tag="" variable="laserTrigger" value="0"/>
      <action type="if" condition="optic_device == 'led' ">
          <action type="assignment" variable="tTrialLaserPowerMw" value="0"></action>
      </action>
      <action tag="Stop IO Device" type="stop_device_IO" device="LabJackU6"></action>
      <action type="dequeue_stimulus" stimulus="stimTwo"></action>
      <action tag="Update Stimulus" type="update_stimulus_display"></action>
    </protocol>
  </experiment>
</monkeyml>